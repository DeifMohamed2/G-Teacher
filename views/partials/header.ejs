<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="G-Teacher Academy - Premier online learning platform for IG students. Connect with expert teachers across all IGCSE subjects including Mathematics, Sciences, Languages, and Humanities.">
  <meta name="keywords"
    content="IGCSE, IG students, online learning, tutoring, academy, education, mathematics, sciences, languages">
  <title>
    <%= title %> - G-Teacher Academy
  </title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/G-TeacherLogo.png">
  <link rel="shortcut icon" type="image/png" href="/images/G-TeacherLogo.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/G-TeacherLogo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/G-TeacherLogo.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/G-TeacherLogo.png">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <!-- Mathematical Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet">

  <!-- AOS - Animate On Scroll Library -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/animations.css">
  <link rel="stylesheet" href="/css/footer.css">
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/index.css">

  <!-- Preload Critical JS -->
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js" as="script">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/gsap@3.9.1/dist/gsap.min.js" as="script">
  <script>
    (function () {
      try {
        var saved = localStorage.getItem('theme') || 'light';
        document.documentElement.classList.remove('light-theme', 'dark-theme');
        document.documentElement.classList.add(saved + '-theme');
        // Apply to body when it's available
        if (document.body) {
          document.body.classList.remove('light-theme', 'dark-theme');
          document.body.classList.add(saved + '-theme');
        } else {
          // Wait for DOM to be ready
          document.addEventListener('DOMContentLoaded', function () {
            document.body.classList.remove('light-theme', 'dark-theme');
            document.body.classList.add(saved + '-theme');
          });
        }
      } catch (e) {
        document.documentElement.classList.add('light-theme');
      }
    })();
  </script>
</head>

<!-- New Minimal Header Styles -->
<style>
  :root {
    --header-height: 76px;
    --primary: #3a92bd;
    --primary-dark: #0c5374;
    --primary-light: #5ba8cf;
    --text-primary: #1a1a2e;
    --text-secondary: #64748b;
    --bg-light: #ffffff;
    --bg-subtle: #f8fafc;
    --border-color: #e2e8f0;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-full: 9999px;
    --transition: all 0.2s ease;
  }

  .dark-theme {
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --bg-light: #0f172a;
    --bg-subtle: #1e293b;
    --border-color: #334155;
  }

  /* Text Selection */
  ::selection {
    background-color: var(--primary);
    color: #ffffff;
  }

  ::-moz-selection {
    background-color: var(--primary);
    color: #ffffff;
  }

  /* Header Base */
  .minimal-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--header-height);
    background: var(--bg-light);
    border-bottom: 1px solid var(--border-color);
    z-index: 1000;
    transition: var(--transition);
  }

  .minimal-header.scrolled {
    box-shadow: var(--shadow-md);
  }

  .header-inner {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 24px;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 32px;
  }

  /* Logo */
  .header-brand {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    flex-shrink: 0;
  }

  .header-brand:hover .brand-name {
    color: var(--primary);
  }

  .brand-icon {
    width: 52px;
    height: 52px;
    border-radius: 12px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    transition: transform 0.2s ease;
  }

  .header-brand:hover .brand-icon {
    transform: scale(1.05);
  }

  .brand-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .brand-text {
    display: flex;
    flex-direction: column;
    line-height: 1.1;
  }

  .brand-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    font-family: 'Inter', sans-serif;
    letter-spacing: -0.3px;
    transition: color 0.2s ease;
  }

  .brand-name .brand-g {
    color: var(--primary);
  }

  .brand-tagline {
    font-size: 0.7rem;
    color: var(--text-secondary);
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  /* Navigation */
  .header-nav {
    display: flex;
    align-items: center;
    gap: 2px;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 10px 18px;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: var(--radius-full);
    transition: var(--transition);
    font-family: 'Inter', sans-serif;
    white-space: nowrap;
  }

  .nav-link:hover {
    color: var(--primary);
    background: rgba(58, 146, 189, 0.08);
  }

  .nav-link.active {
    color: #fff;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    box-shadow: 0 2px 8px rgba(58, 146, 189, 0.3);
  }

  /* More Dropdown */
  .nav-more {
    position: relative;
  }

  .nav-more-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
    background: none;
    border: none;
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: var(--transition);
    font-family: 'Inter', sans-serif;
  }

  .nav-more-btn:hover {
    color: var(--primary);
    background: rgba(58, 146, 189, 0.08);
  }

  .nav-more.open .nav-more-btn {
    color: var(--primary);
    background: rgba(58, 146, 189, 0.1);
  }

  .nav-more-btn i {
    font-size: 0.7rem;
    transition: transform 0.2s ease;
  }

  .nav-more.open .nav-more-btn i {
    transform: rotate(180deg);
  }

  .nav-more-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%) scale(0.95);
    min-width: 180px;
    background: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    padding: 8px;
  }

  .nav-more.open .nav-more-menu {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) scale(1);
  }

  .nav-more-menu a {
    display: block;
    padding: 10px 14px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: var(--radius-sm);
    transition: var(--transition);
  }

  .nav-more-menu a:hover {
    color: var(--primary);
    background: rgba(58, 146, 189, 0.08);
  }

  /* Header Actions */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
  }

  /* Icon Button Base */
  .icon-btn {
    width: 42px;
    height: 42px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-subtle);
    border: 1px solid var(--border-color);
    border-radius: 50%;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    font-size: 1rem;
  }

  .icon-btn:hover {
    color: var(--primary);
    border-color: var(--primary);
    background: rgba(58, 146, 189, 0.1);
    transform: translateY(-1px);
  }

  .icon-btn:active {
    transform: translateY(0);
  }

  /* Theme Toggle */
  .theme-toggle .fa-sun {
    display: none;
  }

  .theme-toggle .fa-moon {
    display: block;
  }

  .dark-theme .theme-toggle .fa-sun {
    display: block;
  }

  .dark-theme .theme-toggle .fa-moon {
    display: none;
  }

  /* Cart Badge */
  .cart-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    min-width: 18px;
    height: 18px;
    padding: 0 5px;
    font-size: 0.65rem;
    font-weight: 600;
    color: #fff;
    background: var(--primary);
    border-radius: var(--radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-badge:empty,
  .cart-badge[data-count="0"] {
    display: none;
  }

  /* Auth Buttons */
  .auth-btns {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 8px;
  }

  .btn-login {
    padding: 10px 20px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
    background: transparent;
    border: 1.5px solid var(--border-color);
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    font-family: 'Inter', sans-serif;
  }

  .btn-login:hover {
    border-color: var(--primary);
    color: var(--primary);
    background: rgba(58, 146, 189, 0.05);
  }

  .btn-signup {
    padding: 10px 22px;
    font-size: 0.875rem;
    font-weight: 600;
    color: #fff;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    border: none;
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: var(--transition);
    text-decoration: none;
    font-family: 'Inter', sans-serif;
    box-shadow: 0 4px 15px rgba(58, 146, 189, 0.3);
  }

  .btn-signup:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(58, 146, 189, 0.4);
    color: #fff;
  }

  .btn-signup:active {
    transform: translateY(0);
  }

  /* User Menu */
  .user-menu {
    position: relative;
  }

  .user-menu-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px 6px 6px;
    background: var(--bg-subtle);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: var(--transition);
  }

  .user-menu-btn:hover {
    border-color: var(--primary);
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 0.875rem;
    font-weight: 600;
  }

  .user-menu-btn span {
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-primary);
    max-width: 100px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .user-menu-btn i.fa-chevron-down {
    font-size: 0.65rem;
    color: var(--text-secondary);
    transition: transform 0.2s ease;
  }

  .user-menu.open .user-menu-btn i.fa-chevron-down {
    transform: rotate(180deg);
  }

  /* User Dropdown */
  .user-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    right: 0;
    width: 240px;
    background: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    opacity: 0;
    visibility: hidden;
    transform: scale(0.95) translateY(-8px);
    transition: all 0.2s ease;
    overflow: hidden;
  }

  .user-menu.open .user-dropdown {
    opacity: 1;
    visibility: visible;
    transform: scale(1) translateY(0);
  }

  .user-dropdown-header {
    padding: 16px;
    background: var(--bg-subtle);
    border-bottom: 1px solid var(--border-color);
  }

  .user-dropdown-header strong {
    display: block;
    font-size: 0.9rem;
    color: var(--text-primary);
    margin-bottom: 2px;
  }

  .user-dropdown-header small {
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  .user-dropdown-body {
    padding: 8px;
  }

  .user-dropdown a {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 12px;
    font-size: 0.875rem;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: var(--radius-sm);
    transition: var(--transition);
  }

  .user-dropdown a:hover {
    color: var(--primary);
    background: rgba(58, 146, 189, 0.08);
  }

  .user-dropdown a i {
    width: 18px;
    text-align: center;
    font-size: 0.9rem;
  }

  .user-dropdown-footer {
    padding: 8px;
    border-top: 1px solid var(--border-color);
  }

  .user-dropdown-footer a {
    color: #ef4444;
  }

  .user-dropdown-footer a:hover {
    background: rgba(239, 68, 68, 0.08);
    color: #dc2626;
  }

  /* Mobile Menu Toggle */
  .mobile-toggle {
    display: none;
    width: 40px;
    height: 40px;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
  }

  .hamburger {
    width: 20px;
    height: 14px;
    position: relative;
  }

  .hamburger span {
    position: absolute;
    width: 100%;
    height: 2px;
    background: var(--text-primary);
    border-radius: 2px;
    transition: all 0.3s ease;
  }

  .hamburger span:nth-child(1) {
    top: 0;
  }

  .hamburger span:nth-child(2) {
    top: 50%;
    transform: translateY(-50%);
  }

  .hamburger span:nth-child(3) {
    bottom: 0;
  }

  .mobile-toggle.active .hamburger span:nth-child(1) {
    top: 50%;
    transform: translateY(-50%) rotate(45deg);
  }

  .mobile-toggle.active .hamburger span:nth-child(2) {
    opacity: 0;
  }

  .mobile-toggle.active .hamburger span:nth-child(3) {
    bottom: 50%;
    transform: translateY(50%) rotate(-45deg);
  }

  /* Mobile Dropdown Nav */
  .mobile-nav-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.3);
    z-index: 999;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }

  .mobile-nav-overlay.active {
    opacity: 1;
    pointer-events: auto;
  }

  .mobile-nav {
    display: none;
    position: absolute;
    top: calc(var(--header-height) - 4px);
    right: 16px;
    width: 260px;
    max-height: calc(100vh - var(--header-height) - 32px);
    background: var(--bg-light);
    z-index: 1001;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    overflow-y: auto;
    transform: translateY(-10px) scale(0.95);
    opacity: 0;
    pointer-events: none;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .mobile-nav.active {
    transform: translateY(0) scale(1);
    opacity: 1;
    pointer-events: auto;
  }

  .mobile-nav-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-subtle);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  }

  .mobile-nav-brand {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .mobile-nav-close {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: 50%;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
  }

  .mobile-nav-close:hover {
    color: var(--primary);
    border-color: var(--primary);
  }

  .mobile-nav-body {
    padding: 12px;
  }

  .mobile-nav-body a {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
    text-decoration: none;
    border-radius: var(--radius-sm);
    margin-bottom: 4px;
    transition: var(--transition);
  }

  .mobile-nav-body a:hover,
  .mobile-nav-body a.active {
    color: var(--primary);
    background: rgba(58, 146, 189, 0.08);
  }

  .mobile-nav-body a i {
    width: 20px;
    text-align: center;
  }

  .mobile-nav-divider {
    height: 1px;
    background: var(--border-color);
    margin: 16px 0;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .header-nav {
      display: none;
    }

    .mobile-toggle {
      display: flex;
    }

    .mobile-nav-overlay,
    .mobile-nav {
      display: block;
    }

    .auth-btns {
      display: none;
    }
  }

  @media (max-width: 640px) {
    .header-inner {
      padding: 0 12px;
    }

    .brand-icon {
      width: 44px;
      height: 44px;
    }

    .brand-text {
      display: flex;
    }

    .brand-name {
      font-size: 1.15rem;
    }

    .brand-tagline {
      font-size: 0.6rem;
    }

    .user-menu-btn span {
      display: none;
    }

    .user-menu-btn {
      padding: 4px;
      border-radius: 50%;
    }

    .icon-btn {
      width: 38px;
      height: 38px;
    }

    .mobile-nav {
      right: 12px;
      width: calc(100vw - 24px);
      max-width: 320px;
    }
  }

  @media (max-width: 400px) {
    .header-inner {
      padding: 0 10px;
      gap: 8px;
    }

    .brand-icon {
      width: 40px;
      height: 40px;
    }

    .brand-name {
      font-size: 1.05rem;
    }

    .brand-tagline {
      display: none;
    }

    .header-actions {
      gap: 4px;
    }

    .icon-btn {
      width: 36px;
      height: 36px;
      font-size: 0.9rem;
    }
  }

  /* Body Padding */
  body {
    padding-top: var(--header-height);
  }
</style>

<body class="<%= theme %>-theme" data-initial-theme="<%= theme %>">

  <!-- Minimal Modern Header -->
  <header class="minimal-header" id="mainHeader">
    <div class="header-inner">
      <!-- Brand -->
      <a href="/" class="header-brand">
        <div class="brand-icon">
          <img src="/images/G-TeacherLogo.png" alt="G-Teacher">
        </div>
        <div class="brand-text">
          <span class="brand-name"><span class="brand-g">G</span>-Teacher</span>
          <span class="brand-tagline">IGCSE Academy</span>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <nav class="header-nav">
        <% if (typeof isIndexPage !=='undefined' && isIndexPage) { %>
          <a href="#hero" class="nav-link active smooth-scroll">Home</a>
          <a href="#ig-courses" class="nav-link smooth-scroll">IG Courses</a>
          <a href="#score-calculator" class="nav-link smooth-scroll">Score Calculator</a>
          <% } else { %>
            <a href="/" class="nav-link">Home</a>
            <a href="/#ig-courses" class="nav-link">IG Courses</a>
            <a href="/#score-calculator" class="nav-link">Score Calculator</a>
            <% } %>
      </nav>

      <!-- Actions -->
      <div class="header-actions">
        <!-- Theme Toggle -->
        <button class="icon-btn theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <i class="fas fa-moon"></i>
          <i class="fas fa-sun"></i>
        </button>

        <!-- Cart -->
        <button class="icon-btn" id="cartToggle" aria-label="Shopping cart">
          <i class="fas fa-shopping-bag"></i>
          <span class="cart-badge" id="cartCount" data-count="<%= cartCount || 0 %>">
            <%= cartCount || 0 %>
          </span>
        </button>

        <% if (locals.user) { %>
          <!-- User Menu -->
          <div class="user-menu" id="userMenu">
            <button class="user-menu-btn" type="button">
              <div class="user-avatar">
                <%= user.name.charAt(0).toUpperCase() %>
              </div>
              <span>
                <%= user.name.split(' ')[0] %></span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="user-dropdown">
            <div class="user-dropdown-header">
              <strong><%= user.name %></strong>
              <small><%= user.email %></small>
            </div>
            <div class="user-dropdown-body">
              <a href="/student/dashboard"><i class="fas fa-th-large"></i> Dashboard</a>
              <a href="/student/enrolled-courses"><i class="fas fa-book"></i> My Courses</a>
              <a href="/student/quizzes"><i class="fas fa-clipboard-list"></i> Quizzes</a>
              <a href="/student/profile"><i class="fas fa-user"></i> Profile</a>
              <a href="/student/settings"><i class="fas fa-cog"></i> Settings</a>
            </div>
            <div class="user-dropdown-footer">
              <a href="/auth/logout"><i class="fas fa-sign-out-alt"></i> Log out</a>
            </div>
          </div>
        </div>
        <% } else { %>
        <!-- Auth Buttons -->
        <div class="auth-btns">
          <a href="/auth/login" class="btn-login">Log in</a>
          <a href="/auth/register" class="btn-signup">Sign up</a>
        </div>
        <% } %>

        <!-- Mobile Toggle -->
        <button class="mobile-toggle" id="mobileToggle" aria-label="Menu">
          <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Navigation -->
  <div class="mobile-nav-overlay" id="mobileOverlay"></div>
  <nav class="mobile-nav" id="mobileNav">
    <div class="mobile-nav-header">
      <div class="mobile-nav-brand">
        <div class="brand-icon" style="width: 36px; height: 36px;">
          <img src="/images/G-TeacherLogo.png" alt="G-Teacher">
        </div>
        <span class="brand-name" style="font-size: 1.1rem;"><span class="brand-g">G</span>-Teacher</span>
      </div>
      <button class="mobile-nav-close" id="mobileClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="mobile-nav-body">
      <% if (typeof isIndexPage !== 'undefined' && isIndexPage) { %>
                  <a href="#hero" class="smooth-scroll"><i class="fas fa-home"></i> Home</a>
                  <a href="#ig-courses" class="smooth-scroll"><i class="fas fa-graduation-cap"></i> IG Courses</a>
                  <a href="#score-calculator" class="smooth-scroll"><i class="fas fa-calculator"></i> Score
                    Calculator</a>
                  <% } else { %>
                    <a href="/"><i class="fas fa-home"></i> Home</a>
                    <a href="/#ig-courses"><i class="fas fa-graduation-cap"></i> IG Courses</a>
                    <a href="/#score-calculator"><i class="fas fa-calculator"></i> Score Calculator</a>
                    <% } %>

                      <div class="mobile-nav-divider"></div>

                      <% if (locals.user) { %>
                        <a href="/student/dashboard"><i class="fas fa-th-large"></i> Dashboard</a>
                        <a href="/student/enrolled-courses"><i class="fas fa-book"></i> My Courses</a>
                        <a href="/student/profile"><i class="fas fa-user"></i> Profile</a>
                        <div class="mobile-nav-divider"></div>
                        <a href="/auth/logout" style="color: #ef4444;"><i class="fas fa-sign-out-alt"></i> Log out</a>
                        <% } else { %>
                          <a href="/auth/login"><i class="fas fa-sign-in-alt"></i> Log in</a>
                          <a href="/auth/register"><i class="fas fa-user-plus"></i> Sign up</a>
                          <% } %>
          </div>
          </nav>

          <!-- Header JavaScript -->
          <script>
            document.addEventListener('DOMContentLoaded', function () {
              const header = document.getElementById('mainHeader');
              const themeToggle = document.getElementById('themeToggle');
              const userMenu = document.getElementById('userMenu');
              const navMore = document.getElementById('navMore');
              const mobileToggle = document.getElementById('mobileToggle');
              const mobileNav = document.getElementById('mobileNav');
              const mobileOverlay = document.getElementById('mobileOverlay');
              const mobileClose = document.getElementById('mobileClose');

              // Scroll effect
              window.addEventListener('scroll', () => {
                header.classList.toggle('scrolled', window.scrollY > 20);
              });

              // Theme toggle
              themeToggle?.addEventListener('click', () => {
                const isDark = document.body.classList.contains('dark-theme');
                document.documentElement.classList.toggle('dark-theme', !isDark);
                document.documentElement.classList.toggle('light-theme', isDark);
                document.body.classList.toggle('dark-theme', !isDark);
                document.body.classList.toggle('light-theme', isDark);
                localStorage.setItem('theme', isDark ? 'light' : 'dark');
              });

              // User menu toggle
              userMenu?.querySelector('.user-menu-btn')?.addEventListener('click', (e) => {
                e.stopPropagation();
                userMenu.classList.toggle('open');
                navMore?.classList.remove('open');
              });

              // More dropdown toggle
              navMore?.querySelector('.nav-more-btn')?.addEventListener('click', (e) => {
                e.stopPropagation();
                navMore.classList.toggle('open');
                userMenu?.classList.remove('open');
              });

              // Close dropdowns on outside click
              document.addEventListener('click', () => {
                userMenu?.classList.remove('open');
                navMore?.classList.remove('open');
              });

              // Mobile navigation
              function openMobileNav() {
                mobileNav.classList.add('active');
                mobileOverlay.classList.add('active');
                mobileToggle.classList.add('active');
                document.body.style.overflow = 'hidden';
              }

              function closeMobileNav() {
                mobileNav.classList.remove('active');
                mobileOverlay.classList.remove('active');
                mobileToggle.classList.remove('active');
                document.body.style.overflow = '';
              }

              mobileToggle?.addEventListener('click', () => {
                if (mobileNav.classList.contains('active')) {
                  closeMobileNav();
                } else {
                  openMobileNav();
                }
              });

              mobileClose?.addEventListener('click', closeMobileNav);
              mobileOverlay?.addEventListener('click', closeMobileNav);

              // Close mobile nav on link click
              mobileNav?.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', closeMobileNav);
              });

              // Smooth scroll for anchor links
              document.querySelectorAll('.smooth-scroll').forEach(link => {
                link.addEventListener('click', function (e) {
                  const href = this.getAttribute('href');
                  if (href.startsWith('#')) {
                    e.preventDefault();
                    const target = document.querySelector(href);
                    if (target) {
                      const headerHeight = header.offsetHeight;
                      const targetPosition = target.getBoundingClientRect().top + window.pageYOffset - headerHeight;
                      window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                      });
                    }
                  }
                });
              });

              // Active nav link on scroll (for index page)
              const sections = document.querySelectorAll('section[id]');
              if (sections.length) {
                window.addEventListener('scroll', () => {
                  const scrollY = window.pageYOffset;
                  sections.forEach(section => {
                    const sectionTop = section.offsetTop - 100;
                    const sectionHeight = section.offsetHeight;
                    const sectionId = section.getAttribute('id');
                    const navLink = document.querySelector(`.nav-link[href="#${sectionId}"], .nav-link[href="/#${sectionId}"]`);

                    if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
                      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                      navLink?.classList.add('active');
                    }
                  });
                });
              }
            });
          </script>

          <!-- Shopping Cart Sidebar - Redesigned -->
          <div class="cart-drawer-overlay" id="cartSidebarOverlay"></div>
          <aside class="cart-drawer" id="cartSidebar">
            <div class="cart-drawer-header">
              <h3>Your Cart <span class="cart-header-count">(<span id="cartHeaderCount">
                    <%= cart.length %>
                  </span>)</span></h3>
              <button class="cart-drawer-close" id="cartSidebarClose">
                <i class="fas fa-times"></i>
              </button>
            </div>

            <div class="cart-drawer-body" id="cartItems">
              <% if (cart.length> 0) { %>
                <% cart.forEach((item, index)=> { %>
                  <div class="cart-product" data-id="<%= item.id %>" data-item-id="<%= item.id %>"
                    data-item-type="<%= item.type %>">
                    <div class="cart-product-img">
                      <img src="<%= item.image %>" alt="<%= item.title %>" loading="lazy">
                    </div>
                    <div class="cart-product-info">
                      <span class="cart-product-tag">
                        <%= item.type==='course' ? 'Course' : 'Course' %>
                      </span>
                      <h4 class="cart-product-title">
                        <%= item.title %>
                      </h4>
                      <span class="cart-product-price">
                        <%= item.price.toFixed(2) %> AED
                      </span>
                    </div>
                    <button class="cart-product-remove" onclick="removeFromCart('<%= item.id %>')" title="Remove">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </div>
                  <% }); %>
                    <% } else { %>
                      <div class="cart-empty-state">
                        <div class="cart-empty-icon">
                          <i class="fas fa-shopping-bag"></i>
                        </div>
                        <h4>Your cart is empty</h4>
                        <p>Explore our courses and start learning!</p>
                        <a href="/#courses" class="cart-empty-btn" onclick="hideCartSidebar()">Browse Courses</a>
                      </div>
                      <% } %>
            </div>

            <div class="cart-drawer-footer">
              <div class="cart-summary">
                <div class="cart-summary-row">
                  <span>Subtotal</span>
                  <span class="cart-subtotal">
                    <%= cart.reduce((sum, item)=> sum + item.price, 0).toFixed(2) %> AED
                  </span>
                </div>
                <div class="cart-summary-row cart-total-row">
                  <span>Total</span>
                  <span class="cart-total-amount">
                    <%= cart.reduce((sum, item)=> sum + item.price, 0).toFixed(2) %> AED
                  </span>
                </div>
              </div>
              <button class="cart-checkout-btn" id="cartCheckout" onclick="proceedToCheckout()" <%=cart.length===0
                ? 'disabled' : '' %>>
                Checkout <i class="fas fa-arrow-right"></i>
              </button>
            </div>
          </aside>

          <!-- Flash Messages -->
          <div class="toast-container" id="toastContainer">
            <% if(locals.success_msg && success_msg !='' ){ %>
              <div class="toast toast-success">
                <i class="fas fa-check-circle"></i>
                <span>
                  <%= success_msg %>
                </span>
                <button class="toast-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>
              </div>
              <% } %>
                <% if(locals.error_msg && error_msg !='' ){ %>
                  <div class="toast toast-error">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>
                      <%= error_msg %>
                    </span>
                    <button class="toast-close" onclick="this.parentElement.remove()"><i
                        class="fas fa-times"></i></button>
                  </div>
                  <% } %>
                    <% if(locals.error && error !='' ){ %>
                      <div class="toast toast-error">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>
                          <%= error %>
                        </span>
                        <button class="toast-close" onclick="this.parentElement.remove()"><i
                            class="fas fa-times"></i></button>
                      </div>
                      <% } %>
          </div>

          <!-- Cart Drawer & Toast Styles -->
          <style>
            /* Toast Notifications */
            .toast-container {
              position: fixed;
              top: 88px;
              right: 20px;
              z-index: 9999;
              display: flex;
              flex-direction: column;
              gap: 10px;
              max-width: 380px;
            }

            .toast {
              display: flex;
              align-items: center;
              gap: 12px;
              padding: 14px 16px;
              background: var(--bg-light);
              border: 1px solid var(--border-color);
              border-radius: var(--radius-md);
              box-shadow: var(--shadow-lg);
              animation: slideIn 0.3s ease;
            }

            .toast i:first-child {
              font-size: 1.1rem;
              flex-shrink: 0;
            }

            .toast span {
              flex: 1;
              font-size: 0.875rem;
              color: var(--text-primary);
              font-weight: 500;
            }

            .toast-close {
              background: none;
              border: none;
              color: var(--text-secondary);
              cursor: pointer;
              padding: 4px;
              opacity: 0.6;
              transition: opacity 0.2s;
            }

            .toast-close:hover {
              opacity: 1;
            }

            .toast-success {
              border-left: 3px solid #10b981;
            }

            .toast-success i:first-child {
              color: #10b981;
            }

            .toast-error {
              border-left: 3px solid #ef4444;
            }

            .toast-error i:first-child {
              color: #ef4444;
            }

            @keyframes slideIn {
              from {
                transform: translateX(100%);
                opacity: 0;
              }

              to {
                transform: translateX(0);
                opacity: 1;
              }
            }

            /* Cart Drawer */
            .cart-drawer-overlay {
              position: fixed;
              inset: 0;
              background: rgba(0, 0, 0, 0.4);
              z-index: 1100;
              opacity: 0;
              visibility: hidden;
              transition: all 0.3s ease;
              backdrop-filter: blur(4px);
            }

            .cart-drawer-overlay.active {
              opacity: 1;
              visibility: visible;
            }

            .cart-drawer {
              position: fixed;
              top: 0;
              right: 0;
              width: 400px;
              max-width: 100%;
              height: 100%;
              background: var(--bg-light);
              z-index: 1101;
              transform: translateX(100%);
              transition: transform 0.3s ease;
              display: flex;
              flex-direction: column;
              box-shadow: -10px 0 40px rgba(0, 0, 0, 0.15);
            }

            .cart-drawer.active {
              transform: translateX(0);
            }

            .cart-drawer-header {
              display: flex;
              align-items: center;
              justify-content: space-between;
              padding: 20px 24px;
              border-bottom: 1px solid var(--border-color);
              flex-shrink: 0;
            }

            .cart-drawer-header h3 {
              font-size: 1.1rem;
              font-weight: 600;
              color: var(--text-primary);
              margin: 0;
              font-family: 'Inter', sans-serif;
            }

            .cart-header-count {
              color: var(--text-secondary);
              font-weight: 400;
            }

            .cart-drawer-close {
              width: 36px;
              height: 36px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: var(--bg-subtle);
              border: 1px solid var(--border-color);
              border-radius: var(--radius-sm);
              color: var(--text-secondary);
              cursor: pointer;
              transition: var(--transition);
            }

            .cart-drawer-close:hover {
              color: var(--text-primary);
              border-color: var(--text-secondary);
            }

            .cart-drawer-body {
              flex: 1;
              overflow-y: auto;
              padding: 20px 24px;
            }

            /* Cart Products */
            .cart-product {
              display: flex;
              align-items: flex-start;
              gap: 14px;
              padding: 16px;
              background: var(--bg-subtle);
              border: 1px solid var(--border-color);
              border-radius: var(--radius-md);
              margin-bottom: 12px;
              transition: var(--transition);
            }

            .cart-product:hover {
              border-color: var(--primary);
            }

            .cart-product:last-child {
              margin-bottom: 0;
            }

            .cart-product-img {
              width: 64px;
              height: 64px;
              border-radius: var(--radius-sm);
              overflow: hidden;
              flex-shrink: 0;
              background: var(--border-color);
            }

            .cart-product-img img {
              width: 100%;
              height: 100%;
              object-fit: cover;
            }

            .cart-product-info {
              flex: 1;
              min-width: 0;
            }

            .cart-product-tag {
              display: inline-block;
              padding: 3px 8px;
              font-size: 0.65rem;
              font-weight: 600;
              color: var(--primary);
              background: rgba(58, 146, 189, 0.1);
              border-radius: var(--radius-full);
              text-transform: uppercase;
              letter-spacing: 0.5px;
              margin-bottom: 6px;
            }

            .cart-product-title {
              font-size: 0.9rem;
              font-weight: 600;
              color: var(--text-primary);
              margin: 0 0 4px;
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap;
              font-family: 'Inter', sans-serif;
            }

            .cart-product-price {
              font-size: 0.95rem;
              font-weight: 700;
              color: var(--primary);
            }

            .cart-product-remove {
              width: 32px;
              height: 32px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: none;
              border: 1px solid transparent;
              border-radius: var(--radius-sm);
              color: var(--text-secondary);
              cursor: pointer;
              transition: var(--transition);
              flex-shrink: 0;
            }

            .cart-product-remove:hover {
              color: #ef4444;
              background: rgba(239, 68, 68, 0.1);
              border-color: rgba(239, 68, 68, 0.2);
            }

            /* Cart Empty State */
            .cart-empty-state {
              text-align: center;
              padding: 48px 24px;
            }

            .cart-empty-icon {
              width: 72px;
              height: 72px;
              margin: 0 auto 20px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: var(--bg-subtle);
              border-radius: 50%;
              color: var(--text-secondary);
              font-size: 1.75rem;
            }

            .cart-empty-state h4 {
              font-size: 1.1rem;
              font-weight: 600;
              color: var(--text-primary);
              margin: 0 0 8px;
            }

            .cart-empty-state p {
              font-size: 0.875rem;
              color: var(--text-secondary);
              margin: 0 0 24px;
            }

            .cart-empty-btn {
              display: inline-flex;
              align-items: center;
              gap: 8px;
              padding: 10px 20px;
              font-size: 0.875rem;
              font-weight: 600;
              color: #fff;
              background: linear-gradient(135deg, var(--primary), var(--primary-dark));
              border-radius: var(--radius-sm);
              text-decoration: none;
              transition: var(--transition);
            }

            .cart-empty-btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 4px 12px rgba(58, 146, 189, 0.3);
              color: #fff;
            }

            /* Cart Footer */
            .cart-drawer-footer {
              padding: 20px 24px;
              border-top: 1px solid var(--border-color);
              background: var(--bg-subtle);
              flex-shrink: 0;
            }

            .cart-summary {
              margin-bottom: 16px;
            }

            .cart-summary-row {
              display: flex;
              justify-content: space-between;
              font-size: 0.875rem;
              color: var(--text-secondary);
              margin-bottom: 8px;
            }

            .cart-total-row {
              padding-top: 12px;
              border-top: 1px solid var(--border-color);
              margin-top: 12px;
              margin-bottom: 0;
            }

            .cart-total-row span {
              font-size: 1rem;
              font-weight: 600;
              color: var(--text-primary);
            }

            .cart-total-amount {
              color: var(--primary) !important;
            }

            .cart-checkout-btn {
              width: 100%;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 10px;
              padding: 14px 24px;
              font-size: 0.95rem;
              font-weight: 600;
              color: #fff;
              background: linear-gradient(135deg, var(--primary), var(--primary-dark));
              border: none;
              border-radius: var(--radius-sm);
              cursor: pointer;
              transition: var(--transition);
              font-family: 'Inter', sans-serif;
            }

            .cart-checkout-btn:hover:not(:disabled) {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(58, 146, 189, 0.35);
            }

            .cart-checkout-btn:disabled {
              opacity: 0.5;
              cursor: not-allowed;
            }

            /* Cart Notification */
            .cart-notification {
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%) scale(0.9);
              background: var(--bg-light);
              border: 1px solid var(--border-color);
              border-radius: var(--radius-md);
              padding: 24px 32px;
              box-shadow: var(--shadow-lg);
              z-index: 10000;
              opacity: 0;
              visibility: hidden;
              transition: all 0.3s ease;
            }

            .cart-notification.show {
              opacity: 1;
              visibility: visible;
              transform: translate(-50%, -50%) scale(1);
            }

            .cart-notification-content {
              display: flex;
              align-items: center;
              gap: 12px;
              font-weight: 500;
              color: var(--text-primary);
            }

            .cart-notification-success .cart-notification-content i {
              color: #10b981;
            }

            .cart-notification-error .cart-notification-content i {
              color: #ef4444;
            }

            /* Mobile */
            @media (max-width: 480px) {
              .toast-container {
                left: 16px;
                right: 16px;
                max-width: none;
              }

              .cart-drawer {
                width: 100%;
              }
            }
          </style>

          <!-- Cart Data -->
          <script>
            window.cartData = <%- JSON.stringify(cart || []) %>;
          </script>

          <!-- Cart JavaScript -->
          <script>
            // Global cart management
            window.globalCart = {
              updateCartCount: function () {
                const cartCount = document.getElementById('cartCount');
                const cartHeaderCount = document.getElementById('cartHeaderCount');
                if (cartCount) {
                  const sessionCart = this.getSessionCart();
                  const totalItems = sessionCart.length;
                  cartCount.textContent = totalItems;
                  cartCount.setAttribute('data-count', totalItems);
                }
                if (cartHeaderCount) {
                  cartHeaderCount.textContent = this.getSessionCart().length;
                }
              },

              getSessionCart: function () {
                return window.sessionCart || [];
              },

              setSessionCart: function (cart) {
                window.sessionCart = cart;
                this.updateCartCount();
              },

              updateCartSidebar: function () {
                this.updateCartCount();
                this.updateCartItems();
                this.updateCartTotals();
              },

              refreshCartData: function () {
                // Fetch latest cart data from server
                fetch('/purchase/cart', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json'
                  }
                })
                  .then(response => {
                    if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                  })
                  .then(data => {
                    if (data.success) {
                      this.setSessionCart(data.cart || []);
                      this.updateCartSidebar();
                    }
                  })
                  .catch(error => {
                    console.error('Failed to refresh cart:', error);
                  });
              },

              updateCartItems: function () {
                const cartItems = document.getElementById('cartItems');
                if (!cartItems) return;

                const sessionCart = this.getSessionCart();

                if (sessionCart.length === 0) {
                  cartItems.innerHTML = `
            <div class="cart-empty-state">
              <div class="cart-empty-icon">
                <i class="fas fa-shopping-bag"></i>
              </div>
              <h4>Your cart is empty</h4>
              <p>Explore our courses and start learning!</p>
              <a href="/#courses" class="cart-empty-btn" onclick="hideCartSidebar()">Browse Courses</a>
            </div>
          `;
                  return;
                }

                cartItems.innerHTML = sessionCart.map(item => `
          <div class="cart-product" data-id="${item.id}" data-item-id="${item.id}" data-item-type="${item.type}">
            <div class="cart-product-img">
              <img src="${item.image}" alt="${item.title}" loading="lazy">
            </div>
            <div class="cart-product-info">
              <span class="cart-product-tag">${item.type === 'course' ? 'Course' : 'Course'}</span>
              <h4 class="cart-product-title">${item.title}</h4>
              <span class="cart-product-price">${item.price.toFixed(2)} AED</span>
            </div>
            <button class="cart-product-remove" onclick="removeFromCart('${item.id}')" title="Remove">
              <i class="fas fa-trash-alt"></i>
            </button>
          </div>
        `).join('');
              },

              updateCartTotals: function () {
                const sessionCart = this.getSessionCart();
                const total = sessionCart.reduce((sum, item) => sum + item.price, 0);

                const subtotalEl = document.querySelector('.cart-subtotal');
                const totalEl = document.querySelector('.cart-total-amount');
                const checkoutBtn = document.getElementById('cartCheckout');

                if (subtotalEl) subtotalEl.textContent = `${total.toFixed(2)} AED`;
                if (totalEl) totalEl.textContent = `${total.toFixed(2)} AED`;
                if (checkoutBtn) checkoutBtn.disabled = sessionCart.length === 0;
              }
            };

            // Add to cart UI only (no server call)
            function addToCartUI(item) {
              if (!window.sessionCart) window.sessionCart = [];

              // Check if item already exists
              const exists = window.sessionCart.find(c => c.id === item.id);
              if (!exists) {
                window.sessionCart.push({
                  id: item.id,
                  type: item.type || 'course',
                  title: item.title,
                  price: item.price,
                  image: item.image
                });
              }

              window.globalCart.updateCartSidebar();
              showCartSidebar();
            }

            // Add to cart (with server call)
            function addToCart(item) {
      <% if (!user) { %>
                showCartNotification('Please login to add items to cart', 'error');
                setTimeout(() => {
                  window.location.href = '/auth/login';
                }, 2000);
                return;
      <% } %>

      if (!window.sessionCart) window.sessionCart = [];
              window.sessionCart.push({
                id: item.id,
                type: item.type || 'course',
                title: item.title,
                price: item.price,
                image: item.image
              });

              window.globalCart.updateCartSidebar();
              showCartNotification('Item added to cart', 'success');
              showCartSidebar();

              fetch('/purchase/cart/add', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  itemId: item.id,
                  itemType: item.type || 'course',
                  title: item.title,
                  price: item.price,
                  image: item.image
                })
              })
                .then(res => res.ok ? res.json() : Promise.reject(res))
                .then(data => {
                  if (!data.success) {
                    window.sessionCart = window.sessionCart.filter(c => c.id !== item.id);
                    window.globalCart.updateCartSidebar();
                    showCartNotification(data.message || 'Failed to add item', 'error');
                  }
                })
                .catch(() => {
                  window.sessionCart = window.sessionCart.filter(c => c.id !== item.id);
                  window.globalCart.updateCartSidebar();
                  showCartNotification('Error adding item', 'error');
                });
            }

            // Remove from cart
            function removeFromCart(itemId) {
              if (!window.sessionCart) return;

              const item = window.sessionCart.find(c => c.id === itemId);
              if (!item) return;

              const btn = document.querySelector(`button[onclick="removeFromCart('${itemId}')"]`);
              if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
              }

              fetch('/purchase/cart/remove', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                  itemId,
                  itemType: item.type
                })
              })
                .then(res => res.ok ? res.json() : Promise.reject(res))
                .then(data => {
                  if (data.success) {
                    window.sessionCart = window.sessionCart.filter(c => c.id !== itemId);
                    window.globalCart.updateCartSidebar();
                    showCartNotification('Item removed', 'success');
                  } else {
                    if (btn) {
                      btn.disabled = false;
                      btn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                    }
                    showCartNotification(data.message || 'Failed to remove', 'error');
                  }
                })
                .catch(() => {
                  if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                  }
                  showCartNotification('Error removing item', 'error');
                });
            }

            // Checkout
            function proceedToCheckout() {
              if (!window.sessionCart || window.sessionCart.length === 0) {
                showCartNotification('Your cart is empty', 'error');
                return;
              }
              window.location.href = '/purchase/checkout';
            }

            // Cart sidebar controls
            function showCartSidebar() {
              document.getElementById('cartSidebar')?.classList.add('active');
              document.getElementById('cartSidebarOverlay')?.classList.add('active');
              document.body.style.overflow = 'hidden';
            }

            function hideCartSidebar() {
              document.getElementById('cartSidebar')?.classList.remove('active');
              document.getElementById('cartSidebarOverlay')?.classList.remove('active');
              document.body.style.overflow = '';
            }

            // Notification
            function showCartNotification(message, type = 'success') {
              const notification = document.createElement('div');
              notification.className = `cart-notification cart-notification-${type}`;
              notification.innerHTML = `<div class="cart-notification-content"><i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i><span>${message}</span></div>`;
              document.body.appendChild(notification);
              setTimeout(() => notification.classList.add('show'), 50);
              setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
              }, 2500);
            }

            // Init
            document.addEventListener('DOMContentLoaded', function () {
              window.sessionCart = window.cartData || [];
              window.globalCart.setSessionCart(window.sessionCart);

              // Cart toggle - with explicit function
              const cartToggleBtn = document.getElementById('cartToggle');
              const cartSidebar = document.getElementById('cartSidebar');
              const cartOverlay = document.getElementById('cartSidebarOverlay');
              const cartCloseBtn = document.getElementById('cartSidebarClose');

              if (cartToggleBtn) {
                cartToggleBtn.addEventListener('click', function (e) {
                  e.preventDefault();
                  e.stopPropagation();
                  if (cartSidebar) cartSidebar.classList.add('active');
                  if (cartOverlay) cartOverlay.classList.add('active');
                  document.body.style.overflow = 'hidden';
                });
              }

              if (cartCloseBtn) {
                cartCloseBtn.addEventListener('click', function () {
                  if (cartSidebar) cartSidebar.classList.remove('active');
                  if (cartOverlay) cartOverlay.classList.remove('active');
                  document.body.style.overflow = '';
                });
              }

              if (cartOverlay) {
                cartOverlay.addEventListener('click', function () {
                  if (cartSidebar) cartSidebar.classList.remove('active');
                  if (cartOverlay) cartOverlay.classList.remove('active');
                  document.body.style.overflow = '';
                });
              }

              document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') hideCartSidebar();
              });

              // Auto-dismiss toasts
              document.querySelectorAll('.toast').forEach(toast => {
                setTimeout(() => {
                  toast.style.animation = 'slideIn 0.3s ease reverse forwards';
                  setTimeout(() => toast.remove(), 300);
                }, 5000);
              });
            });
          </script>

          <!-- Main Content -->