<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/KImage.png">
    <link rel="shortcut icon" type="image/png" href="/images/KImage.png">
    <link rel="apple-touch-icon" href="/images/KImage.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/css/studentCSS/student-main.css">
    <link rel="stylesheet" href="/css/studentCSS/orders.css">
    <link rel="stylesheet" href="/css/theme-toggle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Meta Tags -->
    <meta name="description" content="Order Details - View detailed information about your purchase">
    <meta name="theme-color" content="#dc2626">
</head>
<body class="<%= theme %>-theme">
    <!-- Student Layout -->
    <div class="student-layout">
        <!-- Include Sidebar -->
        <%- include('partials/student-sidebar', { currentPage: 'order-history', student: student }) %>
        
        <!-- Main Content -->
        <main class="student-main">
            <!-- Include Header -->
            <%- include('partials/student-header', { title: title, student: student, theme: theme, currentPage: 'order-details' }) %>
            
            <!-- Order Details Content -->
            <div class="student-content">
                <!-- Back Button -->
                <div class="back-button-container">
                    <a href="/student/order-history" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i>
                        Back to Order History
                    </a>
                </div>

                <!-- Order Details Card -->
                <div class="order-details-container">
                    <!-- Order Header -->
                    <div class="order-header">
                        <div class="order-header-content">
                            <div class="order-info">
                                <h1 class="order-title">
                                    <i class="fas fa-receipt"></i>
                                    Order #<%= order.orderNumber %>
                                </h1>
                                <div class="order-meta">
                                    <span class="order-date">
                                        <i class="fas fa-calendar-alt"></i>
                                        <%= new Date(order.purchasedAt || order.createdAt).toLocaleDateString('en-US', { 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        }) %>
                                    </span>
                                    <span class="order-status status-<%= order.status %>">
                                        <i class="fas fa-circle"></i>
                                        <%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %>
                                    </span>
                                </div>
                            </div>
                            <div class="order-actions-header">
                                <button class="btn btn-outline btn-sm" onclick="printInvoice()">
                                    <i class="fas fa-print"></i>
                                    Print
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Order Content -->
                    <div class="order-content">
                        <!-- Item Information -->
                        <div class="order-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-shopping-bag"></i>
                                    Item Information
                                </h2>
                            </div>
                            
                            <div class="item-card">
                                <div class="item-content">
                                    <!-- Item Thumbnail -->
                                    <div class="item-thumbnail">
                                        <% if (order.item && order.item.thumbnail) { %>
                                            <img src="<%= order.item.thumbnail %>" alt="<%= order.item.title %>" class="item-image">
                                        <% } else { %>
                                            <div class="thumbnail-placeholder">
                                                <% if (order.type === 'course') { %>
                                                    <i class="fas fa-book-open"></i>
                                                <% } else { %>
                                                    <i class="fas fa-layer-group"></i>
                                                <% } %>
                                            </div>
                                        <% } %>
                                    </div>

                                    <!-- Item Details -->
                                    <div class="item-details">
                                        <div class="item-header">
                                            <h3 class="item-title">
                                                <%= order.item ? order.item.title : 'Item not found' %>
                                            </h3>
                                            <div class="item-type-badge">
                                                <% if (order.type === 'course') { %>
                                                    <span class="badge badge-primary">
                                                        <i class="fas fa-book"></i> Week
                                                    </span>
                                                <% } else { %>
                                                    <span class="badge badge-success">
                                                        <i class="fas fa-layer-group"></i> Week
                                                    </span>
                                                <% } %>
                                            </div>
                                        </div>

                                        <div class="item-description">
                                            <p><%= order.item ? (order.item.shortDescription || order.item.description) : 'Description not available' %></p>
                                        </div>

                                        <!-- Item Meta Information -->
                                        <div class="item-meta">
                                            <% if (order.type === 'course' && order.item) { %>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-graduation-cap"></i>
                                                    </div>
                                                    <div class="meta-content">
                                                        <div class="meta-label">Level</div>
                                                        <div class="meta-value"><%= order.item.level %></div>
                                                    </div>
                                                </div>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-clock"></i>
                                                    </div>
                                                    <div class="meta-content">
                                                        <div class="meta-label">Duration</div>
                                                        <div class="meta-value"><%= order.item.duration %> hours</div>
                                                    </div>
                                                </div>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-book"></i>
                                                    </div>
                                                    <div class="meta-content">
                                                        <div class="meta-label">Topics</div>
                                                        <div class="meta-value"><%= order.item.topics ? order.item.topics.length : 0 %> topics</div>
                                                    </div>
                                                </div>
                                            <% } else if (order.type === 'bundle' && order.item) { %>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-calendar-alt"></i>
                                                    </div>
                                            
                                                </div>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-book"></i>
                                                    </div>
                                                    <div class="meta-content">
                                                        <div class="meta-label">Level</div>
                                                        <div class="meta-value"><%= order.item.subject %></div>
                                                    </div>
                                                </div>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-layer-group"></i>
                                                    </div>
                                                    <div class="meta-content">
                                                        <div class="meta-label">Weeks</div>
                                                        <div class="meta-value"><%= order.item.courses ? order.item.courses.length : 0 %> courses</div>
                                                    </div>
                                                </div>
                                                <div class="meta-item">
                                                    <div class="meta-icon">
                                                        <i class="fas fa-clock"></i>
                                                    </div>
                                                    <div class="meta-content">
                                                        <div class="meta-label">Total Duration</div>
                                                        <div class="meta-value"><%= order.item.duration %> hours</div>
                                                    </div>
                                                </div>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Week Courses (if applicable) -->
                        <% if (order.type === 'bundle' && order.item && order.item.courses && order.item.courses.length > 0) { %>
                            <div class="order-section">
                                <div class="section-header">
                                    <h2 class="section-title">
                                        <i class="fas fa-list"></i>
                                        Included Weeks
                                    </h2>
                                </div>
                                
                                <div class="courses-grid">
                                    <% order.item.courses.forEach((course, index) => { %>
                                        <div class="course-card">
                                            <div class="course-number">
                                                <%= index + 1 %>
                                            </div>
                                            <div class="course-info">
                                                <h4 class="course-title"><%= course.title %></h4>
                                                <div class="course-meta">
                                                    <span class="course-duration">
                                                        <i class="fas fa-clock"></i>
                                                        <%= course.duration %>h
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    <% }); %>
                                </div>
                            </div>
                        <% } %>

                        <!-- Promo Code Information (if used) -->
                        <% if (order.appliedPromoCode) { %>
                            <div class="order-section">
                                <div class="section-header">
                                    <h2 class="section-title">
                                        <i class="fas fa-tag"></i>
                                        Promo Code Applied
                                    </h2>
                                </div>
                                
                                <div class="promo-code-card">
                                    <div class="promo-code-content">
                                        <div class="promo-code-info">
                                            <div class="promo-code-header">
                                                <span class="promo-code-badge">
                                                    <i class="fas fa-tag"></i>
                                                    <%= order.appliedPromoCode.code %>
                                                </span>
                                                <span class="promo-code-name"><%= order.appliedPromoCode.name %></span>
                                            </div>
                                            <div class="promo-code-description">
                                                <%= order.appliedPromoCode.description || 'Discount applied successfully' %>
                                            </div>
                                        </div>
                                        <div class="promo-code-discount">
                                            <span class="discount-amount">-<%= order.discountAmount.toFixed(2) %> EGP</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% } %>

                        <!-- Order Summary -->
                        <div class="order-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-receipt"></i>
                                    Order Summary
                                </h2>
                            </div>
                            
                            <div class="order-summary-card">
                                <div class="summary-content">
                                    <div class="summary-row">
                                        <span class="summary-label">Item Price</span>
                                        <span class="summary-value"><%= order.originalAmount ? order.originalAmount.toFixed(2) : order.price.toFixed(2) %> EGP</span>
                                    </div>
                                    <div class="summary-row">
                                        <span class="summary-label">Tax</span>
                                        <span class="summary-value"><%= order.tax ? order.tax.toFixed(2) : '0.00' %> EGP</span>
                                    </div>
                                    <% if (order.discountAmount && order.discountAmount > 0) { %>
                                        <div class="summary-row discount-row">
                                            <span class="summary-label">
                                                <i class="fas fa-tag"></i>
                                                Discount (<%= order.promoCodeUsed || 'Promo Code' %>)
                                            </span>
                                            <span class="summary-value discount-value">-<%= order.discountAmount.toFixed(2) %> EGP</span>
                                        </div>
                                    <% } %>
                                    <div class="summary-divider"></div>
                                    <div class="summary-row total-row">
                                        <span class="summary-label">Total Paid</span>
                                        <span class="summary-value total-value"><%= order.total.toFixed(2) %> EGP</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Order Actions -->
                        <div class="order-section">
                            <div class="section-header">
                                <h2 class="section-title">
                                    <i class="fas fa-cog"></i>
                                    Actions
                                </h2>
                            </div>
                            
                            <div class="order-actions-card">
                                <% if (order.status === 'active' || order.status === 'completed') { %>
                                    <% if (order.type === 'course') { %>
                                        <a href="/student/course/<%= order.course %>" class="btn btn-primary btn-lg">
                                            <i class="fas fa-play"></i>
                                            Start Learning
                                        </a>
                                    <% } else { %>
                                        <a href="/student/enrolled-courses" class="btn btn-primary btn-lg">
                                            <i class="fas fa-play"></i>
                                            View Enrolled Weeks
                                        </a>
                                    <% } %>
                                <% } else { %>
                                    <div class="inactive-order-message">
                                        <i class="fas fa-info-circle"></i>
                                        <span>This order is no longer active. Please contact support if you need assistance.</span>
                                    </div>
                                <% } %>
                                
                                <div class="secondary-actions">
                                    <a href="/student/order-history" class="btn btn-outline">
                                        <i class="fas fa-arrow-left"></i>
                                        Back to Orders
                                    </a>
                                    <button class="btn btn-outline" onclick="printInvoice()">
                                        <i class="fas fa-print"></i>
                                        Print Receipt
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Professional Invoice Template (Hidden) -->
    <div class="invoice-template" id="invoice-template" style="display: none;">
        <div class="invoice-container">
            <!-- Watermark -->
            <div class="invoice-watermark">ELKABLY</div>
            
            <!-- Invoice Header -->
            <div class="invoice-header">
                <div class="invoice-logo-section">
                    <img src="/images/K.png" alt="ELKABLY Logo" class="invoice-logo">
                    <div class="invoice-brand">
                        <h1 class="invoice-brand-name">ELKABLY</h1>
                        <p class="invoice-brand-tagline">Math Is Root of Knowledge</p>
                    </div>
                </div>
                <div class="invoice-header-right">
                    <div class="invoice-type">INVOICE</div>
                    <div class="invoice-number">Order #<%= order.orderNumber %></div>
                </div>
            </div>
            
            <!-- Invoice Info Section -->
            <div class="invoice-info-section">
                <div class="invoice-info-left">
                    <h3 class="invoice-section-title">Bill To:</h3>
                    <div class="invoice-info-content">
                        <p class="invoice-info-line"><strong><%= student.name %></strong></p>
                        <% if (student.studentEmail) { %>
                            <p class="invoice-info-line"><%= student.studentEmail %></p>
                        <% } %>
                        <% if (student.studentCode) { %>
                            <p class="invoice-info-line">Student Code: <%= student.studentCode %></p>
                        <% } %>
                    </div>
                </div>
                <div class="invoice-info-right">
                    <div class="invoice-info-item">
                        <span class="invoice-info-label">Invoice Date:</span>
                        <span class="invoice-info-value"><%= new Date(order.purchasedAt || order.createdAt).toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric'
                        }) %></span>
                    </div>
                    <div class="invoice-info-item">
                        <span class="invoice-info-label">Status:</span>
                        <span class="invoice-info-value status-<%= order.status %>"><%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %></span>
                    </div>
                </div>
            </div>
            
            <!-- Invoice Items -->
            <div class="invoice-items-section">
                <table class="invoice-table">
                    <thead>
                        <tr>
                            <th class="invoice-th-item">Item Description</th>
                            <th class="invoice-th-type">Type</th>
                            <th class="invoice-th-price">Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="invoice-td-item">
                                <div class="invoice-item-details">
                                    <strong class="invoice-item-title"><%= order.item ? order.item.title : 'Item not found' %></strong>
                                    <% if (order.type === 'course' && order.item) { %>
                                        <div class="invoice-item-meta">
                                            <span>Level: <%= order.item.level %></span>
                                            <span>Duration: <%= order.item.duration %>h</span>
                                            <% if (order.item.topics && order.item.topics.length > 0) { %>
                                                <span>Topics: <%= order.item.topics.length %></span>
                                            <% } %>
                                        </div>
                                    <% } else if (order.type === 'bundle' && order.item) { %>
                                        <div class="invoice-item-meta">
                                            <span>Subject: <%= order.item.subject %></span>
                                            <span>Courses: <%= order.item.courses ? order.item.courses.length : 0 %></span>
                                            <% if (order.item.duration) { %>
                                                <span>Total Duration: <%= order.item.duration %>h</span>
                                            <% } %>
                                        </div>
                                    <% } %>
                                </div>
                            </td>
                            <td class="invoice-td-type">
                                <% if (order.type === 'course') { %>
                                    <span class="invoice-badge invoice-badge-primary">Week</span>
                                <% } else { %>
                                    <span class="invoice-badge invoice-badge-success">Course</span>
                                <% } %>
                            </td>
                            <td class="invoice-td-price">
                                <strong><%= order.originalAmount ? order.originalAmount.toFixed(2) : order.price.toFixed(2) %> EGP</strong>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Included Weeks (if bundle) -->
            <% if (order.type === 'bundle' && order.item && order.item.courses && order.item.courses.length > 0) { %>
                <div class="invoice-courses-section">
                    <h3 class="invoice-section-title-small">Included Weeks:</h3>
                    <div class="invoice-courses-list">
                        <% order.item.courses.forEach((course, index) => { %>
                            <div class="invoice-course-item">
                                <span class="course-number-badge"><%= index + 1 %></span>
                                <span class="course-name"><%= course.title %></span>
                                <% if (course.duration) { %>
                                    <span class="course-duration-badge"><%= course.duration %>h</span>
                                <% } %>
                            </div>
                        <% }); %>
                    </div>
                </div>
            <% } %>
            
            <!-- Invoice Totals -->
            <div class="invoice-totals-section">
                <div class="invoice-totals">
                    <div class="invoice-total-row">
                        <span class="invoice-total-label">Subtotal:</span>
                        <span class="invoice-total-value"><%= order.originalAmount ? order.originalAmount.toFixed(2) : order.price.toFixed(2) %> EGP</span>
                    </div>
                    <% if (order.tax && order.tax > 0) { %>
                        <div class="invoice-total-row">
                            <span class="invoice-total-label">Tax:</span>
                            <span class="invoice-total-value"><%= order.tax.toFixed(2) %> EGP</span>
                        </div>
                    <% } %>
                    <% if (order.discountAmount && order.discountAmount > 0) { %>
                        <div class="invoice-total-row discount-row">
                            <span class="invoice-total-label">
                                <i class="fas fa-tag"></i>
                                Discount<% if (order.appliedPromoCode) { %> (<%= order.appliedPromoCode.code %>)<% } %>:
                            </span>
                            <span class="invoice-total-value discount-value">-<%= order.discountAmount.toFixed(2) %> EGP</span>
                        </div>
                    <% } %>
                    <div class="invoice-total-row invoice-total-row-final">
                        <span class="invoice-total-label">Total Amount:</span>
                        <span class="invoice-total-value invoice-total-amount"><%= order.total ? order.total.toFixed(2) : order.price.toFixed(2) %> EGP</span>
                    </div>
                </div>
            </div>
            
            <!-- Invoice Footer -->
            <div class="invoice-footer">
                <div class="invoice-footer-content">
                    <p class="invoice-footer-text">
                        <strong>Thank you for your purchase!</strong>
                    </p>
                    <p class="invoice-footer-text">
                        This is an official invoice from ELKABLY. For any inquiries, please contact us through our website.
                    </p>
                    <div class="invoice-footer-divider"></div>
                    <p class="invoice-footer-note">
                        This invoice was generated on <%= new Date().toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        }) %>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced CSS -->
    <style>
        :root {
            --primary-color: #dc2626;
            --primary-light: #fef2f2;
            --success-color: #059669;
            --success-light: #f0fdf4;
            --warning-color: #d97706;
            --warning-light: #fffbeb;
            --info-color: #0ea5e9;
            --info-light: #f0f9ff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-tertiary: #f3f4f6;
            --border-color: #e5e7eb;
            --border-light: #f3f4f6;
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 0.75rem;
            --spacing-lg: 1rem;
            --spacing-xl: 1.5rem;
            --spacing-2xl: 2rem;
            --spacing-3xl: 3rem;
        }

        .dark-theme {
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
            --bg-tertiary: #374151;
            --border-color: #374151;
            --border-light: #4b5563;
        }

        .order-details-container {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: var(--spacing-2xl);
        }

        .order-header {
            background: linear-gradient(135deg, var(--primary-color), #b91c1c);
            color: white;
            padding: var(--spacing-2xl);
        }

        .order-header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--spacing-xl);
        }

        .order-title {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 var(--spacing-md) 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .order-meta {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            flex-wrap: wrap;
        }

        .order-date {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
        }

        .order-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
        }

        .order-status.status-active,
        .order-status.status-completed {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .order-status.status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .order-status.status-failed,
        .order-status.status-cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .order-actions-header {
            display: flex;
            gap: var(--spacing-md);
        }

        .order-content {
            padding: var(--spacing-2xl);
        }

        .order-section {
            margin-bottom: var(--spacing-3xl);
        }

        .order-section:last-child {
            margin-bottom: 0;
        }

        .section-header {
            margin-bottom: var(--spacing-xl);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .section-title i {
            color: var(--primary-color);
            font-size: 1.25rem;
        }

        .item-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
        }

        .item-content {
            display: flex;
            gap: var(--spacing-xl);
            align-items: flex-start;
        }

        .item-thumbnail {
            width: 120px;
            height: 120px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            flex-shrink: 0;
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-placeholder {
            width: 100%;
            height: 100%;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 2.5rem;
        }

        .item-details {
            flex: 1;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-md);
        }

        .item-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            flex: 1;
        }

        .item-type-badge {
            flex-shrink: 0;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .badge-primary {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-success {
            background: #dcfce7;
            color: #166534;
        }

        .item-description {
            margin-bottom: var(--spacing-lg);
        }

        .item-description p {
            color: var(--text-secondary);
            line-height: 1.6;
            margin: 0;
        }

        .item-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
        }

        .meta-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .meta-content {
            flex: 1;
        }

        .meta-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .meta-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .course-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-lg);
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
        }

        .course-number {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .course-info {
            flex: 1;
        }

        .course-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0 0 var(--spacing-xs) 0;
        }

        .course-meta {
            display: flex;
            gap: var(--spacing-md);
        }

        .course-duration {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .promo-code-card {
            background: linear-gradient(135deg, var(--info-light), #e0f2fe);
            border: 1px solid var(--info-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
        }

        .promo-code-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-xl);
        }

        .promo-code-info {
            flex: 1;
        }

        .promo-code-header {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }

        .promo-code-badge {
            background: var(--info-color);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .promo-code-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .promo-code-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .promo-code-discount {
            text-align: right;
        }

        .discount-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success-color);
            display: block;
        }

        .order-summary-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
        }

        .summary-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
        }

        .summary-row.total-row {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            border-top: 2px solid var(--border-color);
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
        }

        .summary-label {
            color: var(--text-secondary);
        }

        .summary-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .total-value {
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .summary-divider {
            height: 1px;
            background: var(--border-color);
            margin: var(--spacing-sm) 0;
        }

        .discount-row {
            background: var(--success-light);
            border-left: 4px solid var(--success-color);
            padding: var(--spacing-sm) var(--spacing-md);
            margin: var(--spacing-sm) 0;
            border-radius: var(--radius-sm);
        }

        .discount-row .summary-label {
            color: var(--success-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .discount-value {
            color: var(--success-color);
            font-weight: 700;
        }

        .order-actions-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            text-align: center;
        }

        .inactive-order-message {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            background: var(--warning-light);
            color: var(--warning-color);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
        }

        .secondary-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-lg);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #b91c1c;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border-color: var(--border-color);
        }

        .btn-outline:hover {
            background: var(--bg-tertiary);
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: 1.1rem;
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            .order-header-content {
                flex-direction: column;
                gap: var(--spacing-lg);
            }
            
            .order-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-md);
            }
            
            .item-content {
                flex-direction: column;
                gap: var(--spacing-lg);
            }
            
            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-sm);
            }
            
            .item-meta {
                grid-template-columns: 1fr;
            }
            
            .courses-grid {
                grid-template-columns: 1fr;
            }
            
            .promo-code-content {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-md);
            }
            
            .promo-code-discount {
                text-align: left;
                width: 100%;
            }
            
            .secondary-actions {
                flex-direction: column;
            }
        }

        @media print {
            .order-actions-card {
                display: none;
            }
            
            .back-button-container {
                display: none;
            }
        }

        /* Invoice Template Styles (Hidden by default) */
        .invoice-template {
            display: none;
        }
    </style>

    <!-- JavaScript for Professional Invoice Printing -->
    <script>
        // Print Invoice Function
        function printInvoice() {
            const invoiceElement = document.getElementById('invoice-template');
            if (!invoiceElement) {
                alert('Invoice template not found');
                return;
            }
            
            // Create a new window for printing
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            
            // Get the invoice HTML
            const invoiceHTML = invoiceElement.innerHTML;
            
            // Create complete HTML document for printing
            const printDocument = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Invoice - Order #<%= order.orderNumber %></title>
                    <style>
                        ${getPrintStyles()}
                    </style>
                </head>
                <body>
                    ${invoiceHTML}
                    <script>
                        window.onload = function() {
                            window.print();
                        };
                    <\/script>
                </body>
                </html>
            `;
            
            printWindow.document.write(printDocument);
            printWindow.document.close();
        }
        
        // Get Professional Print Styles
        function getPrintStyles() {
            return `
                * {
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background: #ffffff;
                    color: #1a1a1a;
                    line-height: 1.4;
                    padding: 0;
                }
                
                .invoice-container {
                    width: 100%;
                    max-width: 100%;
                    margin: 0;
                    background: #ffffff;
                    position: relative;
                    padding: 15mm 12mm;
                    min-height: 297mm;
                    max-height: 297mm;
                    overflow: hidden;
                }
                
                /* Watermark */
                .invoice-watermark {
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%) rotate(-45deg);
                    font-size: 120px;
                    font-weight: 900;
                    color: rgba(184, 1, 1, 0.04);
                    z-index: 0;
                    letter-spacing: 20px;
                    pointer-events: none;
                    white-space: nowrap;
                    font-family: 'Arial Black', Arial, sans-serif;
                }
                
                /* Invoice Header */
                .invoice-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    margin-bottom: 12mm;
                    padding-bottom: 8mm;
                    border-bottom: 3px solid #b80101;
                    position: relative;
                    z-index: 1;
                }
                
                .invoice-logo-section {
                    display: flex;
                    align-items: center;
                    gap: 15px;
                }
                
                .invoice-logo {
                    width: 60px;
                    height: 60px;
                    object-fit: contain;
                    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
                }
                
                .invoice-brand-name {
                    font-size: 28px;
                    font-weight: 900;
                    color: #b80101;
                    margin: 0;
                    letter-spacing: 2px;
                    line-height: 1.2;
                    font-family: 'Arial Black', Arial, sans-serif;
                }
                
                .invoice-brand-tagline {
                    font-size: 11px;
                    color: #666;
                    margin: 3px 0 0 0;
                    font-style: italic;
                    line-height: 1.2;
                }
                
                .invoice-header-right {
                    text-align: right;
                }
                
                .invoice-type {
                    font-size: 20px;
                    font-weight: 700;
                    color: #b80101;
                    margin-bottom: 5px;
                    letter-spacing: 3px;
                    text-transform: uppercase;
                }
                
                .invoice-number {
                    font-size: 13px;
                    color: #666;
                    font-weight: 600;
                }
                
                /* Invoice Info Section */
                .invoice-info-section {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10mm;
                    padding: 10mm;
                    background: #f8f9fa;
                    border-radius: 6px;
                    border: 1px solid #e5e7eb;
                    position: relative;
                    z-index: 1;
                }
                
                .invoice-info-left {
                    flex: 1;
                }
                
                .invoice-info-right {
                    flex: 1;
                    text-align: right;
                }
                
                .invoice-section-title {
                    font-size: 12px;
                    font-weight: 700;
                    color: #b80101;
                    margin-bottom: 8px;
                    text-transform: uppercase;
                    letter-spacing: 0.8px;
                }
                
                .invoice-info-content {
                    line-height: 1.6;
                }
                
                .invoice-info-line {
                    margin: 3px 0;
                    color: #333;
                    font-size: 12px;
                }
                
                .invoice-info-item {
                    margin-bottom: 6px;
                }
                
                .invoice-info-label {
                    font-weight: 600;
                    color: #666;
                    margin-right: 8px;
                    font-size: 12px;
                }
                
                .invoice-info-value {
                    color: #333;
                    font-weight: 600;
                    font-size: 12px;
                }
                
                .invoice-info-value.status-active,
                .invoice-info-value.status-completed {
                    color: #166534;
                    background: #dcfce7;
                    padding: 3px 10px;
                    border-radius: 4px;
                    font-size: 11px;
                }
                
                .invoice-info-value.status-expired {
                    color: #92400e;
                    background: #fef3c7;
                    padding: 3px 10px;
                    border-radius: 4px;
                    font-size: 11px;
                }
                
                .invoice-info-value.status-cancelled {
                    color: #991b1b;
                    background: #fee2e2;
                    padding: 3px 10px;
                    border-radius: 4px;
                    font-size: 11px;
                }
                
                /* Invoice Items Section */
                .invoice-items-section {
                    margin-bottom: 8mm;
                    position: relative;
                    z-index: 1;
                }
                
                .invoice-table {
                    width: 100%;
                    border-collapse: collapse;
                    background: #ffffff;
                    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                }
                
                .invoice-th-item,
                .invoice-th-type,
                .invoice-th-price {
                    background: #b80101;
                    color: #ffffff;
                    padding: 10px 12px;
                    text-align: left;
                    font-weight: 700;
                    font-size: 11px;
                    text-transform: uppercase;
                    letter-spacing: 0.8px;
                }
                
                .invoice-th-type {
                    text-align: center;
                    width: 100px;
                }
                
                .invoice-th-price {
                    text-align: right;
                    width: 120px;
                }
                
                .invoice-td-item,
                .invoice-td-type,
                .invoice-td-price {
                    padding: 12px;
                    border-bottom: 1px solid #e5e7eb;
                }
                
                .invoice-td-type {
                    text-align: center;
                }
                
                .invoice-td-price {
                    text-align: right;
                    font-size: 13px;
                }
                
                .invoice-item-details {
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                }
                
                .invoice-item-title {
                    font-size: 13px;
                    color: #1a1a1a;
                    font-weight: 700;
                    line-height: 1.4;
                }
                
                .invoice-item-meta {
                    display: flex;
                    gap: 12px;
                    font-size: 11px;
                    color: #666;
                    flex-wrap: wrap;
                }
                
                .invoice-item-meta span {
                    display: flex;
                    align-items: center;
                }
                
                .invoice-badge {
                    display: inline-block;
                    padding: 4px 10px;
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    text-transform: uppercase;
                }
                
                .invoice-badge-primary {
                    background: #dbeafe;
                    color: #1e40af;
                }
                
                .invoice-badge-success {
                    background: #d1fae5;
                    color: #065f46;
                }
                
                /* Included Courses Section */
                .invoice-courses-section {
                    margin-bottom: 8mm;
                    padding: 8mm;
                    background: #f8f9fa;
                    border-radius: 6px;
                    border: 1px solid #e5e7eb;
                    position: relative;
                    z-index: 1;
                }
                
                .invoice-section-title-small {
                    font-size: 11px;
                    font-weight: 700;
                    color: #b80101;
                    margin-bottom: 8px;
                    text-transform: uppercase;
                    letter-spacing: 0.8px;
                }
                
                .invoice-courses-list {
                    display: flex;
                    flex-direction: column;
                    gap: 6px;
                }
                
                .invoice-course-item {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    padding: 6px 8px;
                    background: #ffffff;
                    border-radius: 4px;
                    border: 1px solid #e5e7eb;
                }
                
                .course-number-badge {
                    width: 24px;
                    height: 24px;
                    background: #b80101;
                    color: white;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 10px;
                    font-weight: 700;
                    flex-shrink: 0;
                }
                
                .course-name {
                    flex: 1;
                    font-size: 11px;
                    color: #333;
                    font-weight: 500;
                }
                
                .course-duration-badge {
                    background: #e5e7eb;
                    color: #666;
                    padding: 2px 8px;
                    border-radius: 3px;
                    font-size: 9px;
                    font-weight: 600;
                }
                
                /* Invoice Totals */
                .invoice-totals-section {
                    margin-bottom: 8mm;
                    position: relative;
                    z-index: 1;
                }
                
                .invoice-totals {
                    margin-left: auto;
                    width: 280px;
                    background: #f8f9fa;
                    padding: 12px;
                    border-radius: 6px;
                    border: 1px solid #e5e7eb;
                }
                
                .invoice-total-row {
                    display: flex;
                    justify-content: space-between;
                    padding: 6px 0;
                    border-bottom: 1px solid #e5e7eb;
                }
                
                .invoice-total-row.discount-row {
                    background: #dcfce7;
                    padding: 6px 8px;
                    border-radius: 4px;
                    margin: 4px 0;
                    border-bottom: none;
                }
                
                .invoice-total-row-final {
                    border-bottom: 3px solid #b80101;
                    margin-top: 6px;
                    padding-top: 8px;
                }
                
                .invoice-total-label {
                    font-size: 12px;
                    color: #666;
                    font-weight: 600;
                }
                
                .invoice-total-value {
                    font-size: 12px;
                    color: #333;
                    font-weight: 600;
                }
                
                .invoice-total-amount {
                    font-size: 18px;
                    color: #b80101;
                    font-weight: 900;
                }
                
                .discount-value {
                    color: #166534;
                    font-weight: 700;
                }
                
                /* Invoice Footer */
                .invoice-footer {
                    margin-top: 10mm;
                    padding-top: 8mm;
                    border-top: 2px solid #e5e7eb;
                    position: relative;
                    z-index: 1;
                }
                
                .invoice-footer-content {
                    text-align: center;
                }
                
                .invoice-footer-text {
                    margin: 4px 0;
                    color: #666;
                    font-size: 10px;
                    line-height: 1.5;
                }
                
                .invoice-footer-text strong {
                    color: #b80101;
                    font-size: 11px;
                }
                
                .invoice-footer-divider {
                    height: 1px;
                    background: #e5e7eb;
                    margin: 8px 0;
                }
                
                .invoice-footer-note {
                    font-size: 9px;
                    color: #999;
                    font-style: italic;
                }
                
                /* Print Specific Styles */
                @media print {
                    @page {
                        size: A4;
                        margin: 0;
                    }
                    
                    html, body {
                        width: 210mm;
                        height: 297mm;
                        margin: 0;
                        padding: 0;
                        background: #ffffff;
                        overflow: hidden;
                    }
                    
                    .invoice-container {
                        width: 210mm;
                        height: 297mm;
                        padding: 15mm 12mm;
                        margin: 0;
                        box-shadow: none;
                        page-break-after: avoid;
                        page-break-inside: avoid;
                    }
                    
                    .invoice-watermark {
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%) rotate(-45deg);
                        font-size: 120px;
                        opacity: 0.04;
                        z-index: 0;
                        -webkit-print-color-adjust: exact;
                        print-color-adjust: exact;
                    }
                    
                    /* Ensure colors print */
                    .invoice-th-item,
                    .invoice-th-type,
                    .invoice-th-price {
                        -webkit-print-color-adjust: exact;
                        print-color-adjust: exact;
                    }
                    
                    .invoice-badge-primary,
                    .invoice-badge-success {
                        -webkit-print-color-adjust: exact;
                        print-color-adjust: exact;
                    }
                    
                    .course-number-badge {
                        -webkit-print-color-adjust: exact;
                        print-color-adjust: exact;
                    }
                    
                    /* Prevent page breaks */
                    .invoice-header,
                    .invoice-info-section,
                    .invoice-items-section,
                    .invoice-courses-section,
                    .invoice-totals-section,
                    .invoice-footer {
                        page-break-inside: avoid;
                    }
                    
                    /* Ensure everything fits on one page */
                    .invoice-container * {
                        page-break-inside: avoid;
                    }
                }
            `;
        }
    </script>
</body>
</html>