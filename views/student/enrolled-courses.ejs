<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/images/KImage.png">
  <link rel="shortcut icon" type="image/png" href="/images/KImage.png">
  <link rel="apple-touch-icon" href="/images/KImage.png">

  <!-- CSS -->
  <link rel="stylesheet" href="/css/studentCSS/student-main.css">
  <link rel="stylesheet" href="/css/studentCSS/courses.css">
  <link rel="stylesheet" href="/css/theme-toggle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Meta Tags -->
  <meta name="description" content="My Enrolled Weeks - Continue your learning journey">
  <meta name="theme-color" content="#dc2626">
</head>

<body class="<%= theme %>-theme">
  <!-- Student Layout -->
  <div class="student-layout">
    <!-- Include Sidebar -->
    <%- include('partials/student-sidebar', { currentPage: 'courses', student: student }) %>

    <!-- Main Content -->
    <main class="student-main">
      <!-- Include Header -->
      <%- include('partials/student-header', { title: title, student: student, theme: theme, currentPage: 'courses' }) %>

      <!-- Enrolled Courses Content -->
      <div class="student-content">
        <!-- Page Header -->
        <div class="page-header" style="margin-bottom: var(--spacing-xl);">
          <h2 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">
            My Enrolled Weeks
          </h2>
    
        </div>

        <!-- Search and Filter Bar -->
        <div class="search-filter-bar" style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 12px; padding: var(--spacing-lg); margin-bottom: var(--spacing-xl); box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <form method="GET" action="/student/enrolled-courses" class="filter-form">
            <div class="filter-row" style="display: flex; gap: var(--spacing-md); align-items: center; flex-wrap: wrap;">
              <!-- Search Input -->
              <div class="search-group" style="flex: 1; min-width: 200px;">
                <div style="position: relative;">
                  <input 
                    type="text" 
                    name="search" 
                    placeholder="Search by week name..." 
                    value="<%= filters.search %>"
                    class="search-input"
                    style="width: 100%; padding: 10px 16px 10px 40px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 14px; transition: all 0.3s ease;"
                  >
                  <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 14px;"></i>
                </div>
              </div>

              <!-- Progress Filter -->
              <div class="filter-group">
                <select name="progress" class="filter-select" style="padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 14px; min-width: 140px;">
                  <option value="all" <%= filters.progress === 'all' ? 'selected' : '' %>>All Progress</option>
                  <option value="not-started" <%= filters.progress === 'not-started' ? 'selected' : '' %>>Not Started</option>
                  <option value="in-progress" <%= filters.progress === 'in-progress' ? 'selected' : '' %>>In Progress</option>
                  <option value="completed" <%= filters.progress === 'completed' ? 'selected' : '' %>>Completed</option>
                  <option value="high-progress" <%= filters.progress === 'high-progress' ? 'selected' : '' %>>High Progress (75%+)</option>
                  <option value="low-progress" <%= filters.progress === 'low-progress' ? 'selected' : '' %>>Low Progress (<25%)</option>
                </select>
              </div>

              <!-- Bundle Filter -->
              <div class="filter-group">
                <select name="bundle" class="filter-select" style="padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 14px; min-width: 180px;">
                  <option value="all" <%= filters.bundle === 'all' ? 'selected' : '' %>>All Courses</option>
                  <% if (availableBundles && availableBundles.length > 0) { %>
                    <% availableBundles.forEach(bundle => { %>
                      <option value="<%= bundle._id %>" <%= filters.bundle === bundle._id.toString() ? 'selected' : '' %>><%= bundle.title %></option>
                    <% }); %>
                  <% } %>
                </select>
              </div>

              <!-- Sort Filter -->
              <div class="filter-group">
                <select name="sort" class="filter-select" style="padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 14px; min-width: 140px;">
                  <option value="lastAccessed" <%= filters.sort === 'lastAccessed' ? 'selected' : '' %>>Last Accessed</option>
                  <option value="name" <%= filters.sort === 'name' ? 'selected' : '' %>>Name A-Z</option>
                  <option value="progress" <%= filters.sort === 'progress' ? 'selected' : '' %>>Progress</option>
                  <option value="enrolledAt" <%= filters.sort === 'enrolledAt' ? 'selected' : '' %>>Enrollment Date</option>
                </select>
              </div>

              <!-- Filter Buttons -->
              <div class="filter-actions" style="display: flex; gap: var(--spacing-sm);">
                <button type="submit" class="btn btn-primary btn-sm" style="padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 500;">
                  <i class="fas fa-filter" style="margin-right: 6px;"></i>
                  Apply
                </button>
                <a href="/student/enrolled-courses" class="btn btn-outline btn-sm" style="padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 500;">
                  <i class="fas fa-times" style="margin-right: 6px;"></i>
                  Clear
                </a>
              </div>
            </div>
          </form>
        </div>

        <!-- Results Counter -->
        <div class="results-info" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-secondary); border-radius: 8px;">
          <div class="results-count" style="color: var(--text-primary); font-weight: 500;">
            <i class="fas fa-list" style="margin-right: 8px; color: var(--primary-color);"></i>
            Showing <%= enrolledCourses.length %> of <%= totalCourses || 0 %> weeks
            <% if (filters.search || filters.progress !== 'all' || filters.bundle !== 'all') { %>
              <span style="color: var(--text-muted); font-size: 0.9rem; margin-left: 8px;">
                (filtered)
              </span>
            <% } %>
          </div>
          <% if (filters.search || filters.progress !== 'all' || filters.bundle !== 'all') { %>
          <a href="/student/enrolled-courses" class="btn btn-outline btn-sm" style="padding: 6px 12px; font-size: 0.85rem;">
            <i class="fas fa-times" style="margin-right: 4px;"></i>
            Clear Filters
          </a>
          <% } %>
        </div>

        <!-- Courses Grid -->
        <% if (enrolledCourses && enrolledCourses.length > 0) { %>
        <%
          // Group courses by bundle for better organization
          const groupedCourses = {};
          enrolledCourses.forEach(enrollment => {
            const course = enrollment.course;
            if (!course) return;
            
            const bundleId = course.bundle ? course.bundle._id || course.bundle : 'individual';
            const bundleName = course.bundle ? course.bundle.title || 'Bundle Course' : 'Individual Weeks';
            const bundleThumbnail = course.bundle ? (course.bundle.thumbnail || '') : '';
            
            // Debug: Log bundle information (server-side only)
            // console.log('Debug - Course:', course.title, 'Bundle:', course.bundle, 'BundleName:', bundleName);
            
            if (!groupedCourses[bundleId]) {
              groupedCourses[bundleId] = {
                bundleName: bundleName,
                bundleId: bundleId,
                bundleThumbnail: bundleThumbnail,
                courses: []
              };
            }
            
            groupedCourses[bundleId].courses.push(enrollment);
          });
          
          // Sort courses within each bundle by order
          Object.keys(groupedCourses).forEach(bundleId => {
            groupedCourses[bundleId].courses.sort((a, b) => {
              const orderA = a.course.order || 0;
              const orderB = b.course.order || 0;
              return orderA - orderB;
            });
          });
        %>
        
        <% Object.values(groupedCourses).forEach((bundleGroup, index) => { %>
          <!-- Bundle Name Display (Collapsible Header) - Enhanced with Image -->
          <div class="bundle-name-display" 
               style="margin: var(--spacing-xl) 0 var(--spacing-lg) 0; padding: var(--spacing-lg) var(--spacing-xl); background: var(--bg-secondary); border-left: 5px solid var(--primary-color); border-radius: 0 12px 12px 0; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.08);"
               onclick="toggleBundle('bundle-<%= index %>')">
            <div style="display: flex; align-items: center; justify-content: space-between; gap: var(--spacing-lg);">
              <div style="display: flex; align-items: center; gap: var(--spacing-lg); flex: 1;">
                <!-- Bundle Thumbnail -->
                <div style="width: 80px; height: 80px; border-radius: 12px; overflow: hidden; flex-shrink: 0; background: linear-gradient(135deg, var(--primary-color), #dc2626); box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                  <% if (bundleGroup.bundleThumbnail) { %>
                    <img src="<%= bundleGroup.bundleThumbnail %>" alt="<%= bundleGroup.bundleName %>" style="width: 100%; height: 100%; object-fit: cover;">
                  <% } else { %>
                    <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                      <i class="fas fa-layer-group" style="font-size: 2rem; color: white; opacity: 0.9;"></i>
                    </div>
                  <% } %>
                </div>
                
                <!-- Bundle Info -->
                <div style="display: flex; align-items: center; gap: var(--spacing-md); flex: 1;">
                  <i class="fas fa-chevron-down bundle-toggle-icon" id="icon-bundle-<%= index %>" style="color: var(--primary-color); font-size: 1.2rem; transition: transform 0.3s ease; flex-shrink: 0;"></i>
                  <div style="flex: 1;">
                    <h3 style="margin: 0; font-size: 1.4rem; font-weight: 700; color: var(--text-primary); margin-bottom: 4px;">
                      <%= bundleGroup.bundleName %>
                    </h3>
                    <div style="display: flex; align-items: center; gap: var(--spacing-md); flex-wrap: wrap;">
                      <span style="font-size: 0.95rem; color: var(--text-muted); background: var(--bg-primary); padding: 4px 12px; border-radius: 16px; font-weight: 500;">
                        <i class="fas fa-book" style="margin-right: 4px;"></i>
                        <%= bundleGroup.courses.length %> week<%= bundleGroup.courses.length !== 1 ? 's' : '' %>
                      </span>
                      <span style="font-size: 0.95rem; color: var(--text-muted); font-weight: 500;">
                        <i class="fas fa-chart-line" style="margin-right: 4px; color: var(--primary-color);"></i>
                        Avg. Progress: <%= Math.round(bundleGroup.courses.reduce((sum, c) => sum + (c.progress || 0), 0) / bundleGroup.courses.length) %>%
                      </span>
                    </div>
                  </div>
                </div>
                
                <!-- Buy Book Button -->
                <% 
                  const bundleIdStr = bundleGroup.bundleId.toString();
                  if (bundleBookInfo && bundleBookInfo[bundleIdStr]) { 
                %>
                <% const bookInfo = bundleBookInfo[bundleIdStr]; %>
                <div class="bundle-book-purchase" style="flex-shrink: 0;" onclick="event.stopPropagation();">
                  <a href="/purchase/checkout/book?bundle=<%= bookInfo.bundleId %>" class="btn-buy-book">
                    <div class="btn-buy-book-icon">
                      <i class="fas fa-book"></i>
                    </div>
                    <div class="btn-buy-book-content">
                      <span class="btn-buy-book-label">Buy Book</span>
                      <span class="btn-buy-book-price">EGP <%= bookInfo.bookPrice.toFixed(2) %></span>
                    </div>
                    <i class="fas fa-arrow-right btn-buy-book-arrow"></i>
                  </a>
                </div>
                <% } %>
              </div>
            </div>
          </div>
          
          <!-- Courses in this Bundle (Collapsible Content) -->
          <div class="courses-grid bundle-content" 
               id="bundle-<%= index %>"
               style="display: none; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); overflow: hidden; transition: all 0.3s ease;">
            <% bundleGroup.courses.forEach(enrollment => { 
                            const course = enrollment.course;
                            const progress = enrollment.progress;
                            const status = enrollment.status;
                            const isUnlocked = enrollment.isUnlocked !== false; // Default to true if not set
                            const unlockReason = enrollment.unlockReason || '';
                            const previousCourse = enrollment.previousCourse;
                            
                            // Skip if course is null or undefined
                            if (!course) return;
                        %>
          <div class="course-card <%= isUnlocked ? '' : 'locked-course' %>" 
               onclick="<%= isUnlocked ? `window.location.href='/student/course/${course._id}/content'` : 'void(0)' %>" 
               style="cursor: <%= isUnlocked ? 'pointer' : 'not-allowed' %>; transition: all 0.3s ease; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; <%= !isUnlocked ? 'opacity: 0.6; filter: grayscale(30%);' : '' %>">
            <!-- Course Thumbnail -->
            <div class="course-thumbnail" style="position: relative; height: 160px; background: linear-gradient(135deg, var(--primary-color), #dc2626); display: flex; align-items: center; justify-content: center;">
              <% if (course.thumbnail) { %>
              <img src="<%= course.thumbnail %>" alt="<%= course.title %>" style="width: 100%; height: 100%; object-fit: cover;">
              <% } else { %>
              <i class="fas fa-book-open" style="font-size: 2.5rem; color: white; opacity: 0.8;"></i>
              <% } %>
              
              <!-- Progress Badge -->
              <div style="position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; color: var(--text-primary);">
                <%= progress %>%
              </div>
              
              <!-- Week Badge -->
              <div style="position: absolute; top: 12px; left: 12px; background: rgba(59, 130, 246, 0.9); padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; color: white;">
                <i class="fas fa-book" style="margin-right: 4px;"></i>
                Week <%= course.order || '' %>
              </div>
              
              <!-- Lock Overlay -->
              <% if (!isUnlocked) { %>
              <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10;">
                <i class="fas fa-lock" style="font-size: 3rem; color: white; margin-bottom: 1rem;"></i>
                <p style="color: white; text-align: center; padding: 0 1rem; font-weight: 600; font-size: 0.9rem;">
                  Locked
                </p>
                <% if (previousCourse) { %>
                <p style="color: rgba(255, 255, 255, 0.9); text-align: center; padding: 0 1rem; font-size: 0.8rem; margin-top: 0.5rem;">
                  Complete "<%= previousCourse.title %>" first
                </p>
                <% } else { %>
                <p style="color: rgba(255, 255, 255, 0.9); text-align: center; padding: 0 1rem; font-size: 0.8rem; margin-top: 0.5rem;">
                  <%= unlockReason %>
                </p>
                <% } %>
              </div>
              <% } %>
            </div>

            <!-- Course Content -->
            <div class="course-content">
              <!-- Course Header -->
              <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--spacing-sm);">
                <h3 class="course-title"><%= course.title %></h3>
                <span class="course-status <%= status %>">
                  <%= status.charAt(0).toUpperCase() + status.slice(1) %>
                </span>
              </div>

              <!-- Course Description -->
              <p class="course-description">
                <%= course.shortDescription || course.description.substring(0, 100) + '...' %>
              </p>

              <!-- Course Meta -->
              <div class="course-meta">
                <span class="course-level"><%= course.level %></span>
                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                  <i class="fas fa-clock" style="color: var(--text-muted); font-size: 0.75rem;"></i>
                  <span style="font-size: 0.75rem; color: var(--text-muted);"><%= course.duration %>h</span>
                </div>
              </div>

              <!-- Progress Bar -->
              <div class="course-progress" style="background: var(--bg-secondary); border-radius: 8px; height: 8px; overflow: hidden; margin: var(--spacing-sm) 0;">
                <% 
                  let progressColor = 'linear-gradient(90deg, #ef4444, #dc2626)';
                  if (progress === 100) {
                    progressColor = 'linear-gradient(90deg, #10b981, #059669)';
                  } else if (progress >= 75) {
                    progressColor = 'linear-gradient(90deg, #3b82f6, #1d4ed8)';
                  } else if (progress >= 50) {
                    progressColor = 'linear-gradient(90deg, #f59e0b, #d97706)';
                  }
                %>
                <div class="progress-bar" 
                     style="width: <%= progress %>%; height: 100%; background: <%= progressColor %>; transition: all 0.3s ease; border-radius: 8px;">
                </div>
              </div>

              <!-- Progress Info -->
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
                <span style="font-size: 0.75rem; color: var(--text-muted);">
                  Progress: <%= progress %>%
                </span>
                <span style="font-size: 0.75rem; color: var(--text-muted);">
                  Last accessed: <%= new Date(enrollment.lastAccessed).toLocaleDateString() %>
                </span>
              </div>

              <!-- Course Footer -->
              <div class="course-footer">
                <div style="display: flex; align-items: center; gap: var(--spacing-xs);">
                  <i class="fas fa-book" style="color: var(--text-muted); font-size: 0.75rem;"></i>
                  <span style="font-size: 0.75rem; color: var(--text-muted);">
                    <%= course.topics ? course.topics.length : 0 %> topics
                  </span>
                </div>
                <% if (isUnlocked) { %>
                <a href="/student/course/<%= course._id %>/content" class="btn btn-primary btn-sm">
                  <% if (progress === 100) { %>
                  Review
                  <% } else if (progress > 0) { %>
                  Continue
                  <% } else { %>
                  Start
                  <% } %>
                </a>
                <% } else { %>
                <button class="btn btn-secondary btn-sm" disabled style="cursor: not-allowed;">
                  <i class="fas fa-lock me-1"></i>
                  Locked
                </button>
                <% } %>
              </div>
            </div>
          </div>
            <% }); %>
          </div>
        <% }); %>
        </div>

        <% } else { %>
        <!-- Empty State -->
        <div class="empty-state" style="text-align: center; padding: var(--spacing-2xl);">
          <div style="width: 200px; height: 200px; margin: 0 auto var(--spacing-xl); background-color: var(--bg-secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-book-open" style="font-size: 4rem; color: var(--text-muted); opacity: 0.5;"></i>
          </div>
          <h3 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 1.5rem;">
            No Enrolled Weeks
          </h3>
          <p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl); max-width: 500px; margin-left: auto; margin-right: auto;">
            You haven't enrolled in any courses yet. Browse our course catalog to find interesting topics and start your learning journey.
          </p>
          <div style="display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap;">
            <a href="/#courses" class="btn btn-primary btn-lg">
              <i class="fas fa-search" style="margin-right: var(--spacing-sm);"></i>
              Browse Weeks
            </a>
            <a href="/student/wishlist" class="btn btn-outline btn-lg">
              <i class="fas fa-heart" style="margin-right: var(--spacing-sm);"></i>
              View Wishlist
            </a>
          </div>
        </div>
        <% } %>
      </div>
    </main>
  </div>

  <!-- Additional Styles -->
  <style>
    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .filter-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .course-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .pagination-item:hover {
      background: var(--bg-secondary);
    }
    
    .filter-row {
      gap: 12px;
    }

    /* Enhanced Buy Book Button Styles for Bundle Header */
    .bundle-book-purchase {
      margin-left: auto;
    }

    .btn-buy-book {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      white-space: nowrap;
    }

    .btn-buy-book:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
      background: linear-gradient(135deg, #d97706, #b45309);
      color: white;
      text-decoration: none;
    }

    .btn-buy-book-icon {
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      flex-shrink: 0;
    }

    .btn-buy-book-content {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
    }

    .btn-buy-book-label {
      font-size: 0.8rem;
      opacity: 0.9;
      font-weight: 500;
      line-height: 1.2;
    }

    .btn-buy-book-price {
      font-size: 1rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .btn-buy-book-arrow {
      font-size: 12px;
      opacity: 0.8;
      transition: transform 0.3s ease;
      flex-shrink: 0;
    }

    .btn-buy-book:hover .btn-buy-book-arrow {
      transform: translateX(4px);
    }

    /* Dark theme support */
    .dark-theme .btn-buy-book {
      background: linear-gradient(135deg, #d97706, #b45309);
    }

    .dark-theme .btn-buy-book:hover {
      background: linear-gradient(135deg, #b45309, #92400e);
    }
    
    @media (max-width: 768px) {
      .filter-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-group {
        min-width: 100%;
      }
      
      .filter-group {
        min-width: 100%;
      }
      
      .filter-actions {
        justify-content: center;
      }
      
      .bundle-name-display {
        padding: var(--spacing-md) !important;
      }
      
      .bundle-name-display > div > div:first-child {
        flex-direction: column;
        align-items: flex-start !important;
        gap: var(--spacing-md) !important;
      }
      
      .bundle-name-display > div > div:first-child > div:first-child {
        width: 60px !important;
        height: 60px !important;
      }
      
      .bundle-name-display h3 {
        font-size: 1.1rem !important;
      }
      
      .bundle-name-display > div > div:first-child > div:last-child {
        width: 100%;
      }

      .bundle-book-purchase {
        margin-left: 0;
        margin-top: var(--spacing-md);
        width: 100%;
      }

      .btn-buy-book {
        width: 100%;
        justify-content: center;
      }
    }
  </style>

  <!-- JavaScript -->
  <script>
    // Toggle bundle collapse/expand
    function toggleBundle(bundleId) {
      const bundleContent = document.getElementById(bundleId);
      const icon = document.getElementById('icon-' + bundleId);
      
      if (bundleContent.style.display === 'none') {
        bundleContent.style.display = 'grid';
        icon.style.transform = 'rotate(0deg)';
      } else {
        bundleContent.style.display = 'none';
        icon.style.transform = 'rotate(-90deg)';
      }
    }

    // Add hover effects and interactions
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize all bundle icons to collapsed state
      const bundleIcons = document.querySelectorAll('.bundle-toggle-icon');
      bundleIcons.forEach(icon => {
        icon.style.transform = 'rotate(-90deg)';
      });

      const courseCards = document.querySelectorAll('.course-card');

      courseCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-4px)';
        });

        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });

      // Add hover effect to bundle headers
      const bundleHeaders = document.querySelectorAll('.bundle-name-display');
      bundleHeaders.forEach(header => {
        header.addEventListener('mouseenter', function() {
          this.style.background = 'var(--bg-primary)';
        });
        
        header.addEventListener('mouseleave', function() {
          this.style.background = 'var(--bg-secondary)';
        });
      });

      // Removed auto-submit on filter change - now only submits when Apply button is clicked
    });

    // Progress bar animation
    function animateProgressBars() {
      const progressBars = document.querySelectorAll('.progress-bar');

      progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';

        setTimeout(() => {
          bar.style.width = width;
        }, 100);
      });
    }

    // Animate progress bars when page loads
    window.addEventListener('load', animateProgressBars);
  </script>
</body>

</html>