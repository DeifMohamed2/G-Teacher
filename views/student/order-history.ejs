<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/images/KImage.png">
    <link rel="shortcut icon" type="image/png" href="/images/KImage.png">
    <link rel="apple-touch-icon" href="/images/KImage.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/css/studentCSS/student-main.css">
    <link rel="stylesheet" href="/css/studentCSS/orders.css">
    <link rel="stylesheet" href="/css/theme-toggle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Meta Tags -->
    <meta name="description" content="Order History - View your purchase history">
    <meta name="theme-color" content="#dc2626">
</head>
<body class="<%= theme %>-theme">
    <!-- Student Layout -->
    <div class="student-layout">
        <!-- Include Sidebar -->
        <%- include('partials/student-sidebar', { currentPage: 'order-history', student: student }) %>
        
        <!-- Main Content -->
        <main class="student-main">
            <!-- Include Header -->
            <%- include('partials/student-header', { title: title, student: student, theme: theme, currentPage: 'order-history' }) %>
            
            <!-- Order History Content -->
            <div class="student-content">
                <!-- Page Header -->
                <div class="page-header" style="margin-bottom: var(--spacing-xl);">
                    <h2 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">
                        Order History
                    </h2>
                    <p style="color: var(--text-secondary);">
                        View all your past purchases and order details.
                    </p>
                </div>

                <!-- Orders List -->
                <% if (orders && orders.length > 0) { %>
                    <div class="orders-container">
                        <% orders.forEach(order => { %>
                            <div class="order-card">
                                <!-- Order Header -->
                                <div class="order-header">
                                    <div class="order-info">
                                        <div class="order-number">
                                            <i class="fas fa-receipt"></i>
                                            <span>Order #<%= order.orderNumber %></span>
                                        </div>
                                        <div class="order-date">
                                            <i class="fas fa-calendar"></i>
                                            <span><%= new Date(order.purchasedAt).toLocaleDateString('en-US', { 
                                                year: 'numeric', 
                                                month: 'long', 
                                                day: 'numeric',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            }) %></span>
                                        </div>
                                    </div>
                                    <div class="order-status">
                                        <span class="status-badge status-<%= order.status %>">
                                            <%= order.status.charAt(0).toUpperCase() + order.status.slice(1) %>
                                        </span>
                                    </div>
                                </div>

                                <!-- Order Content -->
                                <div class="order-content">
                                    <div class="order-item">
                                        <!-- Item Thumbnail -->
                                        <div class="item-thumbnail">
                                            <% if (order.item && order.item.thumbnail) { %>
                                                <img src="<%= order.item.thumbnail %>" alt="<%= order.item.title %>">
                                            <% } else { %>
                                                <div class="thumbnail-placeholder">
                                                    <% if (order.type === 'course') { %>
                                                        <i class="fas fa-book-open"></i>
                                                    <% } else { %>
                                                        <i class="fas fa-layer-group"></i>
                                                    <% } %>
                                                </div>
                                            <% } %>
                                        </div>

                                        <!-- Item Details -->
                                        <div class="item-details">
                                            <div class="item-header">
                                                <h3 class="item-title">
                                                    <%= order.item ? order.item.title : 'Item not found' %>
                                                </h3>
                                                <div class="item-type-badge">
                                                    <% if (order.type === 'course') { %>
                                                        <span class="badge badge-primary">
                                                            <i class="fas fa-book"></i> Week
                                                        </span>
                                                    <% } else { %>
                                                        <span class="badge badge-success">
                                                            <i class="fas fa-layer-group"></i> Course
                                                        </span>
                                                    <% } %>
                                                </div>
                                            </div>

                                            <div class="item-meta">
                                                <% if (order.type === 'course' && order.item) { %>
                                                    <div class="meta-item">
                                                        <i class="fas fa-graduation-cap"></i>
                                                        <span><%= order.item.level %></span>
                                                    </div>
                                                    <div class="meta-item">
                                                        <i class="fas fa-clock"></i>
                                                        <span><%= order.item.duration %>h</span>
                                                    </div>
                                                <% } else if (order.type === 'bundle' && order.item) { %>
                                                    <div class="meta-item">
                                                        <i class="fas fa-calendar-alt"></i>
                                                        
                                                    </div>
                                                    <div class="meta-item">
                                                        <i class="fas fa-book"></i>
                                                        <span><%= order.item.subject %></span>
                                                    </div>
                                                    <div class="meta-item">
                                                        <i class="fas fa-layer-group"></i>
                                                        <span><%= order.item.courses ? order.item.courses.length : 0 %> courses</span>
                                                    </div>
                                                <% } %>
                                            </div>
                                        </div>

                                        <!-- Order Price -->
                                        <div class="order-price">
                                            <div class="price-amount">
                                                <%= order.price.toFixed(2) %> EGP
                                            </div>
                                            <div class="price-label">
                                                Total Paid
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Order Actions -->
                                <div class="order-actions">
                                    <a href="/student/order/<%= order.orderNumber %>" class="btn btn-outline btn-sm">
                                        <i class="fas fa-eye"></i>
                                        View Details
                                    </a>
                                    <% if (order.status === 'active') { %>
                                        <% if (order.type === 'course') { %>
                                            <a href="/student/course/<%= order.course %>" class="btn btn-primary btn-sm">
                                                <i class="fas fa-play"></i>
                                                Start Learning
                                            </a>
                                        <% } else { %>
                                            <a href="/student/enrolled-courses" class="btn btn-primary btn-sm">
                                                <i class="fas fa-play"></i>
                                                View Weeks
                                            </a>
                                        <% } %>
                                    <% } %>
                                </div>
                            </div>
                        <% }); %>
                    </div>

                    <!-- Pagination -->
                    <% if (pagination.totalPages > 1) { %>
                        <div class="pagination">
                            <% if (pagination.hasPrev) { %>
                                <a href="?page=<%= pagination.prevPage %>" class="pagination-item">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            <% } %>

                            <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                                <% if (i === pagination.currentPage) { %>
                                    <span class="pagination-item active"><%= i %></span>
                                <% } else { %>
                                    <a href="?page=<%= i %>" class="pagination-item"><%= i %></a>
                                <% } %>
                            <% } %>

                            <% if (pagination.hasNext) { %>
                                <a href="?page=<%= pagination.nextPage %>" class="pagination-item">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            <% } %>
                        </div>
                    <% } %>

                <% } else { %>
                    <!-- Empty State -->
                    <div class="empty-state" style="text-align: center; padding: var(--spacing-2xl);">
                        <div style="width: 200px; height: 200px; margin: 0 auto var(--spacing-xl); background-color: var(--bg-secondary); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-shopping-bag" style="font-size: 4rem; color: var(--text-muted); opacity: 0.5;"></i>
                        </div>
                        <h3 style="color: var(--text-primary); margin-bottom: var(--spacing-md); font-size: 1.5rem;">
                            No Orders Yet
                        </h3>
                        <p style="color: var(--text-secondary); margin-bottom: var(--spacing-xl); max-width: 500px; margin-left: auto; margin-right: auto;">
                            You haven't made any purchases yet. Start exploring our courses and bundles to begin your learning journey.
                        </p>
                        <div style="display: flex; gap: var(--spacing-md); justify-content: center; flex-wrap: wrap;">
                            <a href="/#courses" class="btn btn-primary btn-lg">
                                <i class="fas fa-search" style="margin-right: var(--spacing-sm);"></i>
                                Browse Weeks
                            </a>
                            <a href="/student/wishlist" class="btn btn-outline btn-lg">
                                <i class="fas fa-heart" style="margin-right: var(--spacing-sm);"></i>
                                View Wishlist
                            </a>
                        </div>
                    </div>
                <% } %>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Add hover effects
        document.addEventListener('DOMContentLoaded', function() {
            const orderCards = document.querySelectorAll('.order-card');
            
            orderCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            .orders-container {
                display: flex;
                flex-direction: column;
                gap: var(--spacing-lg);
            }
            
            .order-card {
                background: var(--bg-primary);
                border: 1px solid var(--border-color);
                border-radius: var(--radius-lg);
                overflow: hidden;
                transition: all 0.3s ease;
                box-shadow: var(--shadow-sm);
            }
            
            .order-card:hover {
                box-shadow: var(--shadow-md);
            }
            
            .order-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: var(--spacing-lg);
                background: var(--bg-secondary);
                border-bottom: 1px solid var(--border-color);
            }
            
            .order-info {
                display: flex;
                flex-direction: column;
                gap: var(--spacing-xs);
            }
            
            .order-number {
                display: flex;
                align-items: center;
                gap: var(--spacing-sm);
                font-weight: 600;
                color: var(--text-primary);
            }
            
            .order-number i {
                color: var(--primary-color);
            }
            
            .order-date {
                display: flex;
                align-items: center;
                gap: var(--spacing-sm);
                font-size: 0.9rem;
                color: var(--text-secondary);
            }
            
            .order-date i {
                color: var(--text-muted);
            }
            
            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: var(--radius-full);
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: uppercase;
            }
            
            .status-active {
                background: #dcfce7;
                color: #166534;
            }
            
            .status-expired {
                background: #fef3c7;
                color: #92400e;
            }
            
            .status-cancelled {
                background: #fee2e2;
                color: #991b1b;
            }
            
            .order-content {
                padding: var(--spacing-lg);
            }
            
            .order-item {
                display: flex;
                align-items: center;
                gap: var(--spacing-lg);
            }
            
            .item-thumbnail {
                width: 80px;
                height: 80px;
                border-radius: var(--radius-md);
                overflow: hidden;
                flex-shrink: 0;
            }
            
            .item-thumbnail img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .thumbnail-placeholder {
                width: 100%;
                height: 100%;
                background: var(--bg-secondary);
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--text-muted);
                font-size: 1.5rem;
            }
            
            .item-details {
                flex: 1;
            }
            
            .item-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: var(--spacing-sm);
            }
            
            .item-title {
                font-size: 1.1rem;
                font-weight: 600;
                color: var(--text-primary);
                margin: 0;
            }
            
            .item-type-badge {
                flex-shrink: 0;
            }
            
            .item-meta {
                display: flex;
                flex-wrap: wrap;
                gap: var(--spacing-md);
            }
            
            .meta-item {
                display: flex;
                align-items: center;
                gap: var(--spacing-xs);
                font-size: 0.875rem;
                color: var(--text-secondary);
            }
            
            .meta-item i {
                color: var(--text-muted);
                width: 14px;
            }
            
            .order-price {
                text-align: right;
                flex-shrink: 0;
            }
            
            .price-amount {
                font-size: 1.25rem;
                font-weight: 700;
                color: var(--primary-color);
            }
            
            .price-label {
                font-size: 0.75rem;
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .order-actions {
                padding: var(--spacing-lg);
                background: var(--bg-secondary);
                border-top: 1px solid var(--border-color);
                display: flex;
                gap: var(--spacing-sm);
                justify-content: flex-end;
            }
            
            @media (max-width: 768px) {
                .order-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: var(--spacing-sm);
                }
                
                .order-item {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: var(--spacing-md);
                }
                
                .item-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: var(--spacing-sm);
                }
                
                .order-price {
                    text-align: left;
                }
                
                .order-actions {
                    flex-direction: column;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
