<%- include('../partials/header') %>

<!-- Modern Multi-Step Auth Page Styles -->
<style>
  /* Auth Container */
  .auth-page {
    min-height: 100vh;
    display: flex;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  }
  
  .dark-theme .auth-page {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  }
  
  /* Left Panel - Branding */
  .auth-brand-panel {
    flex: 0 0 42%;
    max-width: 42%;
    background: linear-gradient(145deg, #3a92bd 0%, #0c5374 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 40px;
    position: relative;
    overflow: hidden;
  }
  
  /* Floating shapes */
  .auth-shape {
    position: absolute;
    border-radius: 50%;
    opacity: 0.1;
    background: white;
  }
  
  .auth-shape-1 { width: 300px; height: 300px; top: -100px; left: -100px; }
  .auth-shape-2 { width: 200px; height: 200px; bottom: -50px; right: -50px; }
  .auth-shape-3 { width: 150px; height: 150px; top: 50%; right: 10%; opacity: 0.05; }
  .auth-shape-4 { width: 100px; height: 100px; bottom: 30%; left: 5%; opacity: 0.08; }
  
  /* Brand Content */
  .auth-brand-content {
    position: relative;
    z-index: 2;
    text-align: center;
    color: white;
  }
  
  .auth-logo-wrapper {
    width: 120px;
    height: 120px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 25px;
    backdrop-filter: blur(10px);
    border: 3px solid rgba(255, 255, 255, 0.25);
    animation: logoFloat 6s ease-in-out infinite;
  }
  
  @keyframes logoFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  .auth-logo-img {
    width: 80px;
    height: 80px;
    object-fit: contain;
    border-radius: 50%;
    background: white;
    padding: 10px;
  }
  
  .auth-brand-name {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 8px;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }
  
  .auth-brand-tagline {
    font-size: 1.1rem;
    opacity: 0.9;
    font-weight: 300;
    line-height: 1.5;
  }
  
  .auth-highlights {
    margin-top: 40px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  
  .auth-highlight-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
    transition: all 0.3s ease;
  }
  
  .auth-highlight-item:hover {
    background: rgba(255, 255, 255, 0.18);
    transform: translateX(8px);
  }
  
  .auth-highlight-item i { font-size: 1.2rem; width: 22px; text-align: center; }
  .auth-highlight-item span { font-size: 0.95rem; font-weight: 500; }
  
  /* Right Panel - Form */
  .auth-form-panel {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 30px 40px;
    background: white;
    overflow-y: auto;
  }
  
  .dark-theme .auth-form-panel { background: #1e293b; }
  
  .auth-form-wrapper {
    width: 100%;
    max-width: 520px;
  }
  
  /* Form Header */
  .auth-form-header {
    margin-bottom: 20px;
    text-align: center;
  }
  
  .auth-form-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  
  .auth-form-title i { color: #3a92bd; font-size: 1.6rem; }
  .dark-theme .auth-form-title { color: #f1f5f9; }
  
  .auth-form-subtitle {
    font-size: 0.95rem;
    color: #64748b;
  }
  
  .dark-theme .auth-form-subtitle { color: #94a3b8; }
  
  /* Progress Steps */
  .registration-steps {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 25px 0 15px;
    padding: 0 20px;
  }
  
  .step-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
  }
  
  .step-number {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: #e8f4f8;
    color: #94a3b8;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1rem;
    transition: all 0.3s ease;
    position: relative;
    z-index: 2;
    border: 2px solid #d1e3ea;
  }
  
  .step-item.active .step-number {
    background: linear-gradient(135deg, #3a92bd 0%, #0c5374 100%);
    color: white;
    border-color: #3a92bd;
    box-shadow: 0 0 0 4px rgba(58, 146, 189, 0.15), 0 4px 15px rgba(58, 146, 189, 0.35);
    transform: scale(1.08);
  }
  
  .step-item.completed .step-number {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    border-color: #10b981;
  }

  .step-label {
    font-size: 0.7rem;
    color: #94a3b8;
    font-weight: 500;
    text-align: center;
    margin-top: 8px;
    white-space: nowrap;
  }
  
  .step-item.active .step-label { 
    color: #3a92bd; 
    font-weight: 600; 
  }
  
  .step-item.completed .step-label { 
    color: #10b981; 
  }
  
  /* Connecting Line */
  .step-connector {
    width: 60px;
    height: 3px;
    background: #e2e8f0;
    margin: 0 8px;
    margin-bottom: 28px;
    border-radius: 3px;
    position: relative;
  }
  
  .step-connector.completed {
    background: linear-gradient(90deg, #10b981 0%, #10b981 100%);
  }
  
  .step-connector.active {
    background: linear-gradient(90deg, #3a92bd 50%, #e2e8f0 50%);
  }
  
  /* Dark theme */
  .dark-theme .step-number { 
    background: #374151; 
    color: #94a3b8; 
    border-color: #4b5563;
  }
  .dark-theme .step-connector { 
    background: #374151; 
  }
  
  /* Alert styles */
  .auth-alert {
    padding: 14px 18px;
    border-radius: 10px;
    margin-bottom: 20px;
    border: none;
    background: #fef2f2;
    border-left: 4px solid #ef4444;
  }
  
  .auth-alert strong { color: #dc2626; }
  .auth-alert ul { margin-bottom: 0; padding-left: 18px; color: #7f1d1d; }
  .dark-theme .auth-alert { background: rgba(239, 68, 68, 0.1); }
  .dark-theme .auth-alert ul { color: #fca5a5; }
  
  /* Form Steps */
  .form-step {
    display: none;
  }
  
  .form-step.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .step-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #374151;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .step-title i { color: #3a92bd; }
  .dark-theme .step-title { color: #e2e8f0; border-bottom-color: #374151; }
  
  /* Form Groups */
  .form-group { margin-bottom: 18px; }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }
  
  .form-label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 6px;
    font-size: 0.85rem;
  }
  
  .form-label i { color: #3a92bd; font-size: 0.9rem; width: 16px; }
  .dark-theme .form-label { color: #e2e8f0; }
  
  .input-wrapper { position: relative; }
  
  .form-input, .form-select {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 0.95rem;
    background: #f8fafc;
    color: #1e293b;
    transition: all 0.3s ease;
    outline: none;
  }
  
  .form-input:focus, .form-select:focus {
    border-color: #3a92bd;
    background: white;
    box-shadow: 0 0 0 3px rgba(58, 146, 189, 0.1);
  }
  
  .form-input::placeholder { color: #94a3b8; }
  
  .dark-theme .form-input, .dark-theme .form-select {
    background: #0f172a;
    border-color: #334155;
    color: #f1f5f9;
  }
  
  .dark-theme .form-input:focus, .dark-theme .form-select:focus {
    border-color: #3a92bd;
    background: #1e293b;
    box-shadow: 0 0 0 3px rgba(58, 146, 189, 0.15);
  }
  
  .form-select {
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2364748b' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
  }
  
  .form-hint {
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 4px;
  }
  
  .dark-theme .form-hint { color: #94a3b8; }
  
  /* Phone Input Group */
  .phone-input-group {
    display: flex;
    align-items: stretch;
    border-radius: 10px;
    overflow: hidden;
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    transition: all 0.3s ease;
  }
  
  .phone-input-group:focus-within {
    border-color: #3a92bd;
    background: #fff;
    box-shadow: 0 0 0 3px rgba(58, 146, 189, 0.1);
  }
  
  .country-code-selector {
    display: flex;
    align-items: center;
    background: #e5e7eb;
    border-right: 1px solid #d1d5db;
    min-width: 95px;
  }
  
  .country-select {
    border: none;
    background: transparent;
    padding: 12px 8px 12px 12px;
    font-size: 14px;
    font-weight: 500;
    color: #374151;
    cursor: pointer;
    outline: none;
    width: 100%;
  }
  
  .phone-input {
    flex: 1;
    border: none !important;
    background: transparent !important;
    padding: 12px 14px;
    font-size: 14px;
    color: #374151;
    outline: none;
    box-shadow: none !important;
  }
  
  .phone-input::placeholder { color: #9ca3af; }
  
  .dark-theme .phone-input-group {
    background: #374151;
    border-color: #4b5563;
  }
  
  .dark-theme .phone-input-group:focus-within {
    background: #1f2937;
    border-color: #3a92bd;
  }
  
  .dark-theme .country-code-selector {
    background: #4b5563;
    border-color: #6b7280;
  }
  
  .dark-theme .country-select { color: #d1d5db; }
  .dark-theme .phone-input { color: #d1d5db !important; }
  .dark-theme .phone-input::placeholder { color: #9ca3af; }
  
  /* Phone validation states */
  .phone-input-group.has-error {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
  }
  
  .phone-input-group.has-success {
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }
  
  /* Password toggle */
  .btn-password-toggle {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #94a3b8;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    transition: all 0.3s ease;
  }
  
  .btn-password-toggle:hover {
    color: #3a92bd;
    background: rgba(58, 146, 189, 0.1);
  }
  
  /* Other input wrapper */
  .other-input-wrapper {
    margin-top: 10px;
    display: none;
  }
  
  .other-input-wrapper.visible { display: block; }
  
  /* Checkbox styling */
  .checkbox-wrapper {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin: 20px 0;
    padding: 14px;
    background: #f8fafc;
    border-radius: 10px;
    border: 2px solid transparent;
    transition: all 0.3s ease;
  }
  
  .checkbox-wrapper:hover { background: #f1f5f9; border-color: #e2e8f0; }
  .dark-theme .checkbox-wrapper { background: #374151; }
  .dark-theme .checkbox-wrapper:hover { background: #4b5563; border-color: #4b5563; }
  
  .checkbox-input {
    width: 18px;
    height: 18px;
    accent-color: #3a92bd;
    cursor: pointer;
    margin-top: 2px;
    flex-shrink: 0;
  }
  
  .checkbox-label {
    font-size: 0.85rem;
    color: #475569;
    cursor: pointer;
    font-weight: 500;
    line-height: 1.4;
  }
  
  .dark-theme .checkbox-label { color: #cbd5e1; }
  
  .terms-link {
    color: #3a92bd;
    text-decoration: none;
    font-weight: 600;
  }
  
  .terms-link:hover { text-decoration: underline; }
  .dark-theme .terms-link { color: #5fb3d9; }
  
  /* Navigation Buttons */
  .form-navigation {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    margin-top: 24px;
  }
  
  .btn-nav {
    padding: 12px 24px;
    border-radius: 10px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    border: 2px solid transparent;
  }
  
  .btn-nav-prev {
    background: #f1f5f9;
    color: #64748b;
    border-color: #e2e8f0;
  }
  
  .btn-nav-prev:hover {
    background: #e2e8f0;
    color: #374151;
  }
  
  .dark-theme .btn-nav-prev {
    background: #374151;
    color: #94a3b8;
    border-color: #4b5563;
  }
  
  .dark-theme .btn-nav-prev:hover {
    background: #4b5563;
    color: #e2e8f0;
  }
  
  .btn-nav-next, .btn-submit {
    background: linear-gradient(135deg, #3a92bd 0%, #0c5374 100%);
    color: white;
    border: none;
    flex: 1;
    justify-content: center;
  }
  
  .btn-nav-next:hover, .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(58, 146, 189, 0.35);
  }
  
  .btn-nav:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
  }
  
  /* Error field highlighting */
  .field-error {
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.15) !important;
  }
  
  .field-error-message {
    color: #ef4444;
    font-size: 0.8rem;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  
  .field-error-message i { font-size: 0.75rem; }
  
  /* Form footer */
  .auth-form-footer {
    text-align: center;
    margin-top: 24px;
    padding-top: 18px;
    border-top: 1px solid #e2e8f0;
  }
  
  .dark-theme .auth-form-footer { border-top-color: #334155; }
  
  .auth-form-footer p { color: #64748b; font-size: 0.9rem; }
  .dark-theme .auth-form-footer p { color: #94a3b8; }
  
  .auth-switch-link {
    color: #3a92bd;
    text-decoration: none;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
  }
  
  .auth-switch-link:hover { color: #0c5374; }
  .dark-theme .auth-switch-link { color: #5fb3d9; }
  .dark-theme .auth-switch-link:hover { color: #8fd4f0; }
  
  /* Responsive */
  @media (max-width: 1024px) {
    .auth-brand-panel { flex: 0 0 38%; max-width: 38%; }
    .auth-brand-name { font-size: 2rem; }
    .auth-highlights { display: none; }
  }
  
  @media (max-width: 768px) {
    .auth-page { flex-direction: column; }
    .auth-brand-panel { flex: none; max-width: 100%; padding: 30px 20px; }
    .auth-logo-wrapper { width: 80px; height: 80px; margin-bottom: 15px; }
    .auth-logo-img { width: 50px; height: 50px; padding: 8px; }
    .auth-brand-name { font-size: 1.8rem; }
    .auth-brand-tagline { font-size: 0.9rem; }
    .auth-form-panel { padding: 25px 20px; }
    .auth-form-title { font-size: 1.5rem; }
    .form-row { grid-template-columns: 1fr; gap: 0; }
    .registration-steps { padding: 0 10px; gap: 0; }
    .step-item { flex: 0 0 auto; }
    .step-number { width: 36px; height: 36px; font-size: 0.9rem; }
    .step-connector { width: 40px; height: 2px; }
    .step-label { font-size: 0.65rem; }
    .form-navigation { flex-direction: column; }
    .btn-nav-prev { order: 2; justify-content: center; }
    .btn-nav-next, .btn-submit { order: 1; }
  }
</style>

<!-- Auth Page -->
<div class="auth-page">
  <!-- Left Brand Panel -->
  <div class="auth-brand-panel">
    <div class="auth-shape auth-shape-1"></div>
    <div class="auth-shape auth-shape-2"></div>
    <div class="auth-shape auth-shape-3"></div>
    <div class="auth-shape auth-shape-4"></div>
    
    <div class="auth-brand-content">
      <div class="auth-logo-wrapper">
        <img src="/images/G-TeacherLogo.png" alt="G-Teacher Logo" class="auth-logo-img">
      </div>
      <h1 class="auth-brand-name"><span style="color: rgba(255,255,255,0.9)">G</span>-Teacher</h1>
      <p class="auth-brand-tagline">IGCSE Academy<br>Premium Learning Platform</p>
      
      <div class="auth-highlights">
        <div class="auth-highlight-item">
          <i class="fas fa-graduation-cap"></i>
          <span>Expert IGCSE Tutoring</span>
        </div>
        <div class="auth-highlight-item">
          <i class="fas fa-video"></i>
          <span>Live & Recorded Courses</span>
        </div>
        <div class="auth-highlight-item">
          <i class="fas fa-chart-line"></i>
          <span>Track Your Progress</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Right Form Panel -->
  <div class="auth-form-panel">
    <div class="auth-form-wrapper">
      <!-- Header -->
      <div class="auth-form-header">
        <h2 class="auth-form-title">
          <i class="fas fa-user-plus"></i>
          Create Account
        </h2>
        <p class="auth-form-subtitle">Join us and start your learning journey</p>
        
        <!-- Progress Steps -->
        <div class="registration-steps">
          <div class="step-item active" data-step="1">
            <div class="step-number"><span>1</span></div>
            <span class="step-label">Personal Info</span>
          </div>
          <div class="step-connector" id="connector1"></div>
          <div class="step-item" data-step="2">
            <div class="step-number"><span>2</span></div>
            <span class="step-label">Contact Details</span>
          </div>
          <div class="step-connector" id="connector2"></div>
          <div class="step-item" data-step="3">
            <div class="step-number"><span>3</span></div>
            <span class="step-label">Account Setup</span>
          </div>
        </div>
      </div>
      
      <!-- Error Alert -->
      <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
      <div class="auth-alert" role="alert">
        <strong><i class="fas fa-exclamation-triangle me-2"></i>Registration Failed!</strong>
        <hr class="my-2">
        <ul>
          <% errors.forEach(function(error) { %>
          <li><%= error.msg %></li>
          <% }); %>
        </ul>
      </div>
      <% } %>
      
      <!-- Register Form -->
      <form action="/auth/register" method="POST" id="registerForm">
        
        <!-- Step 1: Personal Information -->
        <div class="form-step active" data-step="1">
          <h3 class="step-title"><i class="fas fa-user-circle"></i> Personal Information</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="firstName" class="form-label">
                <i class="fas fa-user"></i> First Name *
              </label>
              <input type="text" id="firstName" name="firstName" class="form-input" 
                     placeholder="First name" 
                     value="<%= typeof firstName != 'undefined' ? firstName : '' %>" required>
            </div>
            
            <div class="form-group">
              <label for="lastName" class="form-label">
                <i class="fas fa-user"></i> Last Name *
              </label>
              <input type="text" id="lastName" name="lastName" class="form-input" 
                     placeholder="Last name" 
                     value="<%= typeof lastName != 'undefined' ? lastName : '' %>" required>
            </div>
          </div>
          
          <div class="form-group">
            <label for="username" class="form-label">
              <i class="fas fa-at"></i> Username *
            </label>
            <input type="text" id="username" name="username" class="form-input" 
                   placeholder="Choose a unique username" 
                   value="<%= typeof username != 'undefined' ? username : '' %>" required>
            <p class="form-hint">Only letters, numbers, and underscores allowed</p>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="grade" class="form-label">
                <i class="fas fa-graduation-cap"></i> Year/Grade *
              </label>
              <select id="grade" name="grade" class="form-select" required>
                <option value="">Select Year</option>
                <option value="Year 6" <%= typeof grade != 'undefined' && grade == 'Year 6' ? 'selected' : '' %>>Year 6</option>
                <option value="Year 7" <%= typeof grade != 'undefined' && grade == 'Year 7' ? 'selected' : '' %>>Year 7</option>
                <option value="Year 8" <%= typeof grade != 'undefined' && grade == 'Year 8' ? 'selected' : '' %>>Year 8</option>
                <option value="Year 9" <%= typeof grade != 'undefined' && grade == 'Year 9' ? 'selected' : '' %>>Year 9</option>
                <option value="Year 10" <%= typeof grade != 'undefined' && grade == 'Year 10' ? 'selected' : '' %>>Year 10</option>
                <option value="Year 11" <%= typeof grade != 'undefined' && grade == 'Year 11' ? 'selected' : '' %>>Year 11</option>
                <option value="Year 12" <%= typeof grade != 'undefined' && grade == 'Year 12' ? 'selected' : '' %>>Year 12</option>
                <option value="Year 13" <%= typeof grade != 'undefined' && grade == 'Year 13' ? 'selected' : '' %>>Year 13</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="curriculum" class="form-label">
                <i class="fas fa-book-open"></i> Curriculum *
              </label>
              <select id="curriculum" name="curriculum" class="form-select" required>
                <option value="">Select Curriculum</option>
                <option value="IGCSE" <%= typeof curriculum != 'undefined' && curriculum == 'IGCSE' ? 'selected' : '' %>>IGCSE</option>
                <option value="American" <%= typeof curriculum != 'undefined' && curriculum == 'American' ? 'selected' : '' %>>American</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Step 2: Contact Details -->
        <div class="form-step" data-step="2">
          <h3 class="step-title"><i class="fas fa-phone-alt"></i> Contact Details</h3>
          
          <div class="form-group">
            <label for="studentEmail" class="form-label">
              <i class="fas fa-envelope"></i> Email Address *
            </label>
            <input type="email" id="studentEmail" name="studentEmail" class="form-input" 
                   placeholder="Enter your email address" 
                   value="<%= typeof studentEmail != 'undefined' ? studentEmail : (typeof email != 'undefined' ? email : '') %>" required>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="studentNumber" class="form-label">
                <i class="fas fa-mobile-alt"></i> Student Phone
              </label>
              <div class="phone-input-group" id="studentPhoneGroup">
                <div class="country-code-selector">
                  <select id="studentCountryCode" name="studentCountryCode" class="country-select">
                    <option value="+20" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+20' ? 'selected' : (typeof studentCountryCode == 'undefined' ? 'selected' : '') %>>ðŸ‡ªðŸ‡¬ +20</option>
                    <option value="+966" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+966' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡¦ +966</option>
                    <option value="+971" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+971' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡ª +971</option>
                    <option value="+965" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+965' ? 'selected' : '' %>>ðŸ‡°ðŸ‡¼ +965</option>
                    <option value="+974" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+974' ? 'selected' : '' %>>ðŸ‡¶ðŸ‡¦ +974</option>
                    <option value="+973" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+973' ? 'selected' : '' %>>ðŸ‡§ðŸ‡­ +973</option>
                    <option value="+968" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+968' ? 'selected' : '' %>>ðŸ‡´ðŸ‡² +968</option>
                    <option value="+962" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+962' ? 'selected' : '' %>>ðŸ‡¯ðŸ‡´ +962</option>
                    <option value="+961" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+961' ? 'selected' : '' %>>ðŸ‡±ðŸ‡§ +961</option>
                    <option value="+963" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+963' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡¾ +963</option>
                    <option value="+964" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+964' ? 'selected' : '' %>>ðŸ‡®ðŸ‡¶ +964</option>
                    <option value="+967" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+967' ? 'selected' : '' %>>ðŸ‡¾ðŸ‡ª +967</option>
                    <option value="+970" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+970' ? 'selected' : '' %>>ðŸ‡µðŸ‡¸ +970</option>
                    <option value="+212" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+212' ? 'selected' : '' %>>ðŸ‡²ðŸ‡¦ +212</option>
                    <option value="+213" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+213' ? 'selected' : '' %>>ðŸ‡©ðŸ‡¿ +213</option>
                    <option value="+216" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+216' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡³ +216</option>
                    <option value="+218" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+218' ? 'selected' : '' %>>ðŸ‡±ðŸ‡¾ +218</option>
                    <option value="+249" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+249' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡© +249</option>
                    <option value="+44" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+44' ? 'selected' : '' %>>ðŸ‡¬ðŸ‡§ +44</option>
                    <option value="+49" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+49' ? 'selected' : '' %>>ðŸ‡©ðŸ‡ª +49</option>
                    <option value="+33" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+33' ? 'selected' : '' %>>ðŸ‡«ðŸ‡· +33</option>
                    <option value="+39" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+39' ? 'selected' : '' %>>ðŸ‡®ðŸ‡¹ +39</option>
                    <option value="+34" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+34' ? 'selected' : '' %>>ðŸ‡ªðŸ‡¸ +34</option>
                    <option value="+31" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+31' ? 'selected' : '' %>>ðŸ‡³ðŸ‡± +31</option>
                    <option value="+32" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+32' ? 'selected' : '' %>>ðŸ‡§ðŸ‡ª +32</option>
                    <option value="+41" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+41' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡­ +41</option>
                    <option value="+43" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+43' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡¹ +43</option>
                    <option value="+46" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+46' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡ª +46</option>
                    <option value="+47" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+47' ? 'selected' : '' %>>ðŸ‡³ðŸ‡´ +47</option>
                    <option value="+45" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+45' ? 'selected' : '' %>>ðŸ‡©ðŸ‡° +45</option>
                    <option value="+358" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+358' ? 'selected' : '' %>>ðŸ‡«ðŸ‡® +358</option>
                    <option value="+48" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+48' ? 'selected' : '' %>>ðŸ‡µðŸ‡± +48</option>
                    <option value="+30" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+30' ? 'selected' : '' %>>ðŸ‡¬ðŸ‡· +30</option>
                    <option value="+90" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+90' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡· +90</option>
                    <option value="+7" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+7' ? 'selected' : '' %>>ðŸ‡·ðŸ‡º +7</option>
                    <option value="+380" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+380' ? 'selected' : '' %>>ðŸ‡ºðŸ‡¦ +380</option>
                    <option value="+351" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+351' ? 'selected' : '' %>>ðŸ‡µðŸ‡¹ +351</option>
                    <option value="+353" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+353' ? 'selected' : '' %>>ðŸ‡®ðŸ‡ª +353</option>
                    <option value="+1" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+1' ? 'selected' : '' %>>ðŸ‡ºðŸ‡¸ +1</option>
                    <option value="+52" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+52' ? 'selected' : '' %>>ðŸ‡²ðŸ‡½ +52</option>
                    <option value="+55" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+55' ? 'selected' : '' %>>ðŸ‡§ðŸ‡· +55</option>
                    <option value="+54" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+54' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡· +54</option>
                    <option value="+57" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+57' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡´ +57</option>
                    <option value="+56" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+56' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡± +56</option>
                    <option value="+51" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+51' ? 'selected' : '' %>>ðŸ‡µðŸ‡ª +51</option>
                    <option value="+58" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+58' ? 'selected' : '' %>>ðŸ‡»ðŸ‡ª +58</option>
                    <option value="+91" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+91' ? 'selected' : '' %>>ðŸ‡®ðŸ‡³ +91</option>
                    <option value="+92" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+92' ? 'selected' : '' %>>ðŸ‡µðŸ‡° +92</option>
                    <option value="+880" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+880' ? 'selected' : '' %>>ðŸ‡§ðŸ‡© +880</option>
                    <option value="+86" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+86' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡³ +86</option>
                    <option value="+81" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+81' ? 'selected' : '' %>>ðŸ‡¯ðŸ‡µ +81</option>
                    <option value="+82" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+82' ? 'selected' : '' %>>ðŸ‡°ðŸ‡· +82</option>
                    <option value="+60" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+60' ? 'selected' : '' %>>ðŸ‡²ðŸ‡¾ +60</option>
                    <option value="+65" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+65' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡¬ +65</option>
                    <option value="+66" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+66' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡­ +66</option>
                    <option value="+62" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+62' ? 'selected' : '' %>>ðŸ‡®ðŸ‡© +62</option>
                    <option value="+63" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+63' ? 'selected' : '' %>>ðŸ‡µðŸ‡­ +63</option>
                    <option value="+84" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+84' ? 'selected' : '' %>>ðŸ‡»ðŸ‡³ +84</option>
                    <option value="+61" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+61' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡º +61</option>
                    <option value="+64" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+64' ? 'selected' : '' %>>ðŸ‡³ðŸ‡¿ +64</option>
                    <option value="+234" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+234' ? 'selected' : '' %>>ðŸ‡³ðŸ‡¬ +234</option>
                    <option value="+27" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+27' ? 'selected' : '' %>>ðŸ‡¿ðŸ‡¦ +27</option>
                    <option value="+254" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+254' ? 'selected' : '' %>>ðŸ‡°ðŸ‡ª +254</option>
                    <option value="+233" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+233' ? 'selected' : '' %>>ðŸ‡¬ðŸ‡­ +233</option>
                    <option value="+255" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+255' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡¿ +255</option>
                    <option value="+256" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+256' ? 'selected' : '' %>>ðŸ‡ºðŸ‡¬ +256</option>
                    <option value="+251" <%= typeof studentCountryCode != 'undefined' && studentCountryCode == '+251' ? 'selected' : '' %>>ðŸ‡ªðŸ‡¹ +251</option>
                  </select>
                </div>
                <input type="tel" id="studentNumber" name="studentNumber" class="phone-input" 
                       placeholder="Student phone number" 
                       value="<%= typeof studentNumber != 'undefined' ? studentNumber : '' %>">
              </div>
              <p class="form-hint" id="studentPhoneHint">Enter digits only</p>
            </div>
            
            <div class="form-group">
              <label for="parentNumber" class="form-label">
                <i class="fas fa-phone"></i> Parent Phone
              </label>
              <div class="phone-input-group" id="parentPhoneGroup">
                <div class="country-code-selector">
                  <select id="parentCountryCode" name="parentCountryCode" class="country-select">
                    <option value="+20" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+20' ? 'selected' : (typeof parentCountryCode == 'undefined' ? 'selected' : '') %>>ðŸ‡ªðŸ‡¬ +20</option>
                    <option value="+966" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+966' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡¦ +966</option>
                    <option value="+971" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+971' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡ª +971</option>
                    <option value="+965" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+965' ? 'selected' : '' %>>ðŸ‡°ðŸ‡¼ +965</option>
                    <option value="+974" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+974' ? 'selected' : '' %>>ðŸ‡¶ðŸ‡¦ +974</option>
                    <option value="+973" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+973' ? 'selected' : '' %>>ðŸ‡§ðŸ‡­ +973</option>
                    <option value="+968" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+968' ? 'selected' : '' %>>ðŸ‡´ðŸ‡² +968</option>
                    <option value="+962" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+962' ? 'selected' : '' %>>ðŸ‡¯ðŸ‡´ +962</option>
                    <option value="+961" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+961' ? 'selected' : '' %>>ðŸ‡±ðŸ‡§ +961</option>
                    <option value="+963" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+963' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡¾ +963</option>
                    <option value="+964" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+964' ? 'selected' : '' %>>ðŸ‡®ðŸ‡¶ +964</option>
                    <option value="+967" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+967' ? 'selected' : '' %>>ðŸ‡¾ðŸ‡ª +967</option>
                    <option value="+970" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+970' ? 'selected' : '' %>>ðŸ‡µðŸ‡¸ +970</option>
                    <option value="+212" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+212' ? 'selected' : '' %>>ðŸ‡²ðŸ‡¦ +212</option>
                    <option value="+213" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+213' ? 'selected' : '' %>>ðŸ‡©ðŸ‡¿ +213</option>
                    <option value="+216" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+216' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡³ +216</option>
                    <option value="+218" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+218' ? 'selected' : '' %>>ðŸ‡±ðŸ‡¾ +218</option>
                    <option value="+249" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+249' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡© +249</option>
                    <option value="+44" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+44' ? 'selected' : '' %>>ðŸ‡¬ðŸ‡§ +44</option>
                    <option value="+49" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+49' ? 'selected' : '' %>>ðŸ‡©ðŸ‡ª +49</option>
                    <option value="+33" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+33' ? 'selected' : '' %>>ðŸ‡«ðŸ‡· +33</option>
                    <option value="+39" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+39' ? 'selected' : '' %>>ðŸ‡®ðŸ‡¹ +39</option>
                    <option value="+34" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+34' ? 'selected' : '' %>>ðŸ‡ªðŸ‡¸ +34</option>
                    <option value="+31" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+31' ? 'selected' : '' %>>ðŸ‡³ðŸ‡± +31</option>
                    <option value="+32" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+32' ? 'selected' : '' %>>ðŸ‡§ðŸ‡ª +32</option>
                    <option value="+41" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+41' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡­ +41</option>
                    <option value="+43" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+43' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡¹ +43</option>
                    <option value="+46" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+46' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡ª +46</option>
                    <option value="+47" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+47' ? 'selected' : '' %>>ðŸ‡³ðŸ‡´ +47</option>
                    <option value="+45" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+45' ? 'selected' : '' %>>ðŸ‡©ðŸ‡° +45</option>
                    <option value="+358" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+358' ? 'selected' : '' %>>ðŸ‡«ðŸ‡® +358</option>
                    <option value="+48" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+48' ? 'selected' : '' %>>ðŸ‡µðŸ‡± +48</option>
                    <option value="+30" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+30' ? 'selected' : '' %>>ðŸ‡¬ðŸ‡· +30</option>
                    <option value="+90" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+90' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡· +90</option>
                    <option value="+7" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+7' ? 'selected' : '' %>>ðŸ‡·ðŸ‡º +7</option>
                    <option value="+380" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+380' ? 'selected' : '' %>>ðŸ‡ºðŸ‡¦ +380</option>
                    <option value="+351" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+351' ? 'selected' : '' %>>ðŸ‡µðŸ‡¹ +351</option>
                    <option value="+353" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+353' ? 'selected' : '' %>>ðŸ‡®ðŸ‡ª +353</option>
                    <option value="+1" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+1' ? 'selected' : '' %>>ðŸ‡ºðŸ‡¸ +1</option>
                    <option value="+52" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+52' ? 'selected' : '' %>>ðŸ‡²ðŸ‡½ +52</option>
                    <option value="+55" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+55' ? 'selected' : '' %>>ðŸ‡§ðŸ‡· +55</option>
                    <option value="+54" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+54' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡· +54</option>
                    <option value="+57" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+57' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡´ +57</option>
                    <option value="+56" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+56' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡± +56</option>
                    <option value="+51" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+51' ? 'selected' : '' %>>ðŸ‡µðŸ‡ª +51</option>
                    <option value="+58" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+58' ? 'selected' : '' %>>ðŸ‡»ðŸ‡ª +58</option>
                    <option value="+91" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+91' ? 'selected' : '' %>>ðŸ‡®ðŸ‡³ +91</option>
                    <option value="+92" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+92' ? 'selected' : '' %>>ðŸ‡µðŸ‡° +92</option>
                    <option value="+880" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+880' ? 'selected' : '' %>>ðŸ‡§ðŸ‡© +880</option>
                    <option value="+86" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+86' ? 'selected' : '' %>>ðŸ‡¨ðŸ‡³ +86</option>
                    <option value="+81" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+81' ? 'selected' : '' %>>ðŸ‡¯ðŸ‡µ +81</option>
                    <option value="+82" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+82' ? 'selected' : '' %>>ðŸ‡°ðŸ‡· +82</option>
                    <option value="+60" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+60' ? 'selected' : '' %>>ðŸ‡²ðŸ‡¾ +60</option>
                    <option value="+65" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+65' ? 'selected' : '' %>>ðŸ‡¸ðŸ‡¬ +65</option>
                    <option value="+66" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+66' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡­ +66</option>
                    <option value="+62" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+62' ? 'selected' : '' %>>ðŸ‡®ðŸ‡© +62</option>
                    <option value="+63" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+63' ? 'selected' : '' %>>ðŸ‡µðŸ‡­ +63</option>
                    <option value="+84" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+84' ? 'selected' : '' %>>ðŸ‡»ðŸ‡³ +84</option>
                    <option value="+61" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+61' ? 'selected' : '' %>>ðŸ‡¦ðŸ‡º +61</option>
                    <option value="+64" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+64' ? 'selected' : '' %>>ðŸ‡³ðŸ‡¿ +64</option>
                    <option value="+234" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+234' ? 'selected' : '' %>>ðŸ‡³ðŸ‡¬ +234</option>
                    <option value="+27" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+27' ? 'selected' : '' %>>ðŸ‡¿ðŸ‡¦ +27</option>
                    <option value="+254" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+254' ? 'selected' : '' %>>ðŸ‡°ðŸ‡ª +254</option>
                    <option value="+233" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+233' ? 'selected' : '' %>>ðŸ‡¬ðŸ‡­ +233</option>
                    <option value="+255" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+255' ? 'selected' : '' %>>ðŸ‡¹ðŸ‡¿ +255</option>
                    <option value="+256" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+256' ? 'selected' : '' %>>ðŸ‡ºðŸ‡¬ +256</option>
                    <option value="+251" <%= typeof parentCountryCode != 'undefined' && parentCountryCode == '+251' ? 'selected' : '' %>>ðŸ‡ªðŸ‡¹ +251</option>
                  </select>
                </div>
                <input type="tel" id="parentNumber" name="parentNumber" class="phone-input" 
                       placeholder="Parent phone number" 
                       value="<%= typeof parentNumber != 'undefined' ? parentNumber : '' %>">
              </div>
              <p class="form-hint" id="parentPhoneHint">Enter digits only</p>
            </div>
          </div>
          
          <div class="form-group">
            <label for="howDidYouKnow" class="form-label">
              <i class="fas fa-question-circle"></i> How did you know G-Teacher?
            </label>
            <select id="howDidYouKnow" name="howDidYouKnow" class="form-select">
              <option value="">Select an option (optional)</option>
              <option value="Facebook" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'Facebook' ? 'selected' : '' %>>Facebook</option>
              <option value="Instagram" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'Instagram' ? 'selected' : '' %>>Instagram</option>
              <option value="TikTok" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'TikTok' ? 'selected' : '' %>>TikTok</option>
              <option value="YouTube" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'YouTube' ? 'selected' : '' %>>YouTube</option>
              <option value="Friend" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'Friend' ? 'selected' : '' %>>Friend/Family</option>
              <option value="School" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'School' ? 'selected' : '' %>>School</option>
              <option value="Google" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'Google' ? 'selected' : '' %>>Google Search</option>
              <option value="Other" <%= typeof howDidYouKnow != 'undefined' && howDidYouKnow == 'Other' ? 'selected' : '' %>>Other</option>
            </select>
            <div class="other-input-wrapper" id="otherInputWrapper">
              <input type="text" id="howDidYouKnowOther" name="howDidYouKnowOther" class="form-input" 
                     placeholder="Please specify..." 
                     value="<%= typeof howDidYouKnowOther != 'undefined' ? howDidYouKnowOther : '' %>">
            </div>
          </div>
        </div>
        
        <!-- Step 3: Account Setup -->
        <div class="form-step" data-step="3">
          <h3 class="step-title"><i class="fas fa-lock"></i> Account Setup</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="password" class="form-label">
                <i class="fas fa-key"></i> Password *
              </label>
              <div class="input-wrapper">
                <input type="password" id="password" name="password" class="form-input" 
                       placeholder="Create a password" required minlength="4">
                <button type="button" class="btn-password-toggle" onclick="togglePassword('password')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
              <p class="form-hint">Minimum 4 characters</p>
            </div>
            
            <div class="form-group">
              <label for="password2" class="form-label">
                <i class="fas fa-key"></i> Confirm Password *
              </label>
              <div class="input-wrapper">
                <input type="password" id="password2" name="password2" class="form-input" 
                       placeholder="Confirm password" required>
                <button type="button" class="btn-password-toggle" onclick="togglePassword('password2')">
                  <i class="fas fa-eye"></i>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Terms Checkbox -->
          <div class="checkbox-wrapper">
            <input type="checkbox" id="termsCheck" name="termsAccepted" class="checkbox-input" required>
            <label for="termsCheck" class="checkbox-label">
              I agree to the <a href="/terms-of-service" target="_blank" class="terms-link">Terms of Service</a> 
              and <a href="/privacy-policy" target="_blank" class="terms-link">Privacy Policy</a>
            </label>
          </div>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="form-navigation">
          <button type="button" class="btn-nav btn-nav-prev" id="prevStep" style="display: none;">
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          
          <button type="button" class="btn-nav btn-nav-next" id="nextStep">
            Next <i class="fas fa-arrow-right"></i>
          </button>
          
          <button type="submit" class="btn-nav btn-submit" id="submitBtn" style="display: none;">
            <span>Create Account</span> <i class="fas fa-rocket"></i>
          </button>
        </div>
      </form>
      
      <!-- Footer -->
      <div class="auth-form-footer">
        <p>Already have an account? 
          <a href="/auth/login" class="auth-switch-link">
            Sign In <i class="fas fa-arrow-right"></i>
          </a>
        </p>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Phone length standards for all countries
  const phoneLengthStandards = {
    // Middle East & North Africa
    '+20': 11,   // Egypt: 11 digits (including leading 0)
    '+966': 9,   // Saudi Arabia: 9 digits
    '+971': 9,   // UAE: 9 digits
    '+965': 8,   // Kuwait: 8 digits
    '+974': 8,   // Qatar: 8 digits
    '+973': 8,   // Bahrain: 8 digits
    '+968': 8,   // Oman: 8 digits
    '+962': 9,   // Jordan: 9 digits
    '+961': 8,   // Lebanon: 8 digits
    '+963': 9,   // Syria: 9 digits
    '+964': 10,  // Iraq: 10 digits
    '+967': 9,   // Yemen: 9 digits
    '+970': 9,   // Palestine: 9 digits
    '+212': 9,   // Morocco: 9 digits
    '+213': 9,   // Algeria: 9 digits
    '+216': 8,   // Tunisia: 8 digits
    '+218': 10,  // Libya: 10 digits
    '+249': 9,   // Sudan: 9 digits
    // Europe
    '+44': 10,   // UK: 10 digits
    '+49': 11,   // Germany: 10-11 digits
    '+33': 9,    // France: 9 digits
    '+39': 10,   // Italy: 10 digits
    '+34': 9,    // Spain: 9 digits
    '+31': 9,    // Netherlands: 9 digits
    '+32': 9,    // Belgium: 9 digits
    '+41': 9,    // Switzerland: 9 digits
    '+43': 10,   // Austria: 10 digits
    '+46': 9,    // Sweden: 9 digits
    '+47': 8,    // Norway: 8 digits
    '+45': 8,    // Denmark: 8 digits
    '+358': 10,  // Finland: 9-10 digits
    '+48': 9,    // Poland: 9 digits
    '+30': 10,   // Greece: 10 digits
    '+90': 10,   // Turkey: 10 digits
    '+7': 10,    // Russia: 10 digits
    '+380': 9,   // Ukraine: 9 digits
    '+351': 9,   // Portugal: 9 digits
    '+353': 9,   // Ireland: 9 digits
    // Americas
    '+1': 10,    // USA/Canada: 10 digits
    '+52': 10,   // Mexico: 10 digits
    '+55': 11,   // Brazil: 11 digits
    '+54': 10,   // Argentina: 10 digits
    '+57': 10,   // Colombia: 10 digits
    '+56': 9,    // Chile: 9 digits
    '+51': 9,    // Peru: 9 digits
    '+58': 10,   // Venezuela: 10 digits
    // Asia & Pacific
    '+91': 10,   // India: 10 digits
    '+92': 10,   // Pakistan: 10 digits
    '+880': 10,  // Bangladesh: 10 digits
    '+86': 11,   // China: 11 digits
    '+81': 10,   // Japan: 10 digits
    '+82': 10,   // South Korea: 10 digits
    '+60': 10,   // Malaysia: 9-10 digits
    '+65': 8,    // Singapore: 8 digits
    '+66': 9,    // Thailand: 9 digits
    '+62': 11,   // Indonesia: 10-11 digits
    '+63': 10,   // Philippines: 10 digits
    '+84': 10,   // Vietnam: 9-10 digits
    '+61': 9,    // Australia: 9 digits
    '+64': 9,    // New Zealand: 9 digits
    // Africa
    '+234': 10,  // Nigeria: 10 digits
    '+27': 9,    // South Africa: 9 digits
    '+254': 9,   // Kenya: 9 digits
    '+233': 9,   // Ghana: 9 digits
    '+255': 9,   // Tanzania: 9 digits
    '+256': 9,   // Uganda: 9 digits
    '+251': 9    // Ethiopia: 9 digits
  };
  
  // Default phone length range for countries not in the list
  const DEFAULT_MIN_PHONE_LENGTH = 7;
  const DEFAULT_MAX_PHONE_LENGTH = 15;
  
  // DOM Elements
  const form = document.getElementById('registerForm');
  const nextStepBtn = document.getElementById('nextStep');
  const prevStepBtn = document.getElementById('prevStep');
  const submitBtn = document.getElementById('submitBtn');
  const formSteps = document.querySelectorAll('.form-step');
  const stepItems = document.querySelectorAll('.step-item');
  
  // Phone Elements
  const studentNumberInput = document.getElementById('studentNumber');
  const studentCountrySelect = document.getElementById('studentCountryCode');
  const parentNumberInput = document.getElementById('parentNumber');
  const parentCountrySelect = document.getElementById('parentCountryCode');
  
  let currentStep = 1;
  const totalSteps = 3;
  
  // ============================================
  // Phone Input Formatting & Real-time Validation
  // ============================================
  
  // Format phone input - remove non-digits and handle leading zeros
  function formatPhoneInput(input, countryCode) {
    let value = input.value;
    
    // Remove all non-digit characters
    value = value.replace(/\D/g, '');
    
    // For Egypt (+20), allow leading 0 and limit to 11 digits
    // For other countries, remove leading 0 and apply their limits
    const expectedLength = phoneLengthStandards[countryCode];
    
    if (countryCode === '+20') {
      // Egypt: keep as is, max 11 digits
      value = value.substring(0, 11);
    } else if (expectedLength) {
      // Remove leading zeros for non-Egypt countries
      if (value.startsWith('0') && countryCode !== '+20') {
        value = value.substring(1);
      }
      value = value.substring(0, expectedLength);
    } else {
      // Default: max 15 digits
      value = value.substring(0, DEFAULT_MAX_PHONE_LENGTH);
    }
    
    input.value = value;
    return value;
  }
  
  // Validate phone number
  function validatePhoneNumber(phone, countryCode) {
    // Remove any non-digit characters
    const cleanPhone = phone.replace(/\D/g, '');
    
    // Empty is OK (optional field)
    if (cleanPhone.length === 0) {
      return { valid: true, message: '', isEmpty: true };
    }
    
    const expectedLength = phoneLengthStandards[countryCode];
    
    if (expectedLength) {
      if (cleanPhone.length !== expectedLength) {
        const countryNames = {
          '+966': 'Saudi Arabia',
          '+20': 'Egypt',
          '+971': 'UAE',
          '+965': 'Kuwait'
        };
        const countryName = countryNames[countryCode] || countryCode;
        return { 
          valid: false, 
          message: `${countryName} requires ${expectedLength} digits (you entered ${cleanPhone.length})`,
          currentLength: cleanPhone.length,
          expectedLength: expectedLength
        };
      }
    } else {
      // Default validation for unknown country codes
      if (cleanPhone.length < DEFAULT_MIN_PHONE_LENGTH || cleanPhone.length > DEFAULT_MAX_PHONE_LENGTH) {
        return { 
          valid: false, 
          message: `Phone number should be ${DEFAULT_MIN_PHONE_LENGTH}-${DEFAULT_MAX_PHONE_LENGTH} digits`,
          currentLength: cleanPhone.length
        };
      }
    }
    
    return { valid: true, message: '', currentLength: cleanPhone.length };
  }
  
  // Update phone hint with validation status
  function updatePhoneHint(hintId, countryCode, currentValue) {
    const hint = document.getElementById(hintId);
    const expectedLength = phoneLengthStandards[countryCode];
    const cleanValue = currentValue.replace(/\D/g, '');
    const currentLength = cleanValue.length;
    
    if (currentLength === 0) {
      // Empty - show expected format
      if (expectedLength) {
        hint.innerHTML = `Enter ${expectedLength} digits`;
        hint.style.color = '';
      } else {
        hint.innerHTML = 'Enter digits only';
        hint.style.color = '';
      }
    } else if (expectedLength) {
      // Show progress
      if (currentLength < expectedLength) {
        hint.innerHTML = `<span style="color: #f59e0b;"><i class="fas fa-info-circle"></i> ${currentLength}/${expectedLength} digits</span>`;
      } else if (currentLength === expectedLength) {
        hint.innerHTML = `<span style="color: #10b981;"><i class="fas fa-check-circle"></i> Valid phone number</span>`;
      } else {
        hint.innerHTML = `<span style="color: #ef4444;"><i class="fas fa-exclamation-circle"></i> Too many digits (${currentLength}/${expectedLength})</span>`;
      }
    } else {
      // Default validation feedback
      if (currentLength >= DEFAULT_MIN_PHONE_LENGTH && currentLength <= DEFAULT_MAX_PHONE_LENGTH) {
        hint.innerHTML = `<span style="color: #10b981;"><i class="fas fa-check-circle"></i> Valid (${currentLength} digits)</span>`;
      } else if (currentLength < DEFAULT_MIN_PHONE_LENGTH) {
        hint.innerHTML = `<span style="color: #f59e0b;"><i class="fas fa-info-circle"></i> ${currentLength} digits (min ${DEFAULT_MIN_PHONE_LENGTH})</span>`;
      } else {
        hint.innerHTML = `<span style="color: #ef4444;"><i class="fas fa-exclamation-circle"></i> Too many digits</span>`;
      }
    }
  }
  
  // Update phone input group visual state
  function updatePhoneGroupState(groupId, isValid, isEmpty) {
    const group = document.getElementById(groupId);
    group.classList.remove('has-error', 'has-success');
    
    if (!isEmpty) {
      if (isValid) {
        group.classList.add('has-success');
      } else {
        group.classList.add('has-error');
      }
    }
  }
  
  // Setup phone input handlers
  function setupPhoneInput(input, countrySelect, hintId, groupId) {
    // Input event - format and validate as user types
    input.addEventListener('input', function() {
      const countryCode = countrySelect.value;
      formatPhoneInput(this, countryCode);
      
      const validation = validatePhoneNumber(this.value, countryCode);
      updatePhoneHint(hintId, countryCode, this.value);
      updatePhoneGroupState(groupId, validation.valid, validation.isEmpty);
    });
    
    // Blur event - final validation
    input.addEventListener('blur', function() {
      const countryCode = countrySelect.value;
      const validation = validatePhoneNumber(this.value, countryCode);
      
      if (!validation.isEmpty && !validation.valid) {
        updatePhoneGroupState(groupId, false, false);
      }
    });
    
    // Country code change - revalidate
    countrySelect.addEventListener('change', function() {
      const countryCode = this.value;
      
      // Re-format the input for new country code
      if (input.value) {
        formatPhoneInput(input, countryCode);
      }
      
      // Update hint
      updatePhoneHint(hintId, countryCode, input.value);
      
      // Revalidate
      const validation = validatePhoneNumber(input.value, countryCode);
      updatePhoneGroupState(groupId, validation.valid, validation.isEmpty);
    });
    
    // Initialize hint on page load
    updatePhoneHint(hintId, countrySelect.value, input.value);
  }
  
  // Setup both phone inputs
  setupPhoneInput(studentNumberInput, studentCountrySelect, 'studentPhoneHint', 'studentPhoneGroup');
  setupPhoneInput(parentNumberInput, parentCountrySelect, 'parentPhoneHint', 'parentPhoneGroup');
  
  // Connector elements
  const connector1 = document.getElementById('connector1');
  const connector2 = document.getElementById('connector2');
  
  // Update step visibility
  function updateSteps() {
    formSteps.forEach((step, index) => {
      step.classList.toggle('active', index + 1 === currentStep);
    });
    
    stepItems.forEach((item, index) => {
      const stepNum = index + 1;
      item.classList.remove('active', 'completed');
      if (stepNum === currentStep) {
        item.classList.add('active');
      } else if (stepNum < currentStep) {
        item.classList.add('completed');
      }
    });
    
    // Update connectors
    connector1.classList.remove('active', 'completed');
    connector2.classList.remove('active', 'completed');
    
    if (currentStep === 1) {
      connector1.classList.add('active');
    } else if (currentStep >= 2) {
      connector1.classList.add('completed');
      if (currentStep === 2) {
        connector2.classList.add('active');
      } else {
        connector2.classList.add('completed');
      }
    }
    
    // Update buttons
    prevStepBtn.style.display = currentStep > 1 ? 'flex' : 'none';
    nextStepBtn.style.display = currentStep < totalSteps ? 'flex' : 'none';
    submitBtn.style.display = currentStep === totalSteps ? 'flex' : 'none';
  }
  
  // Validate step
  function validateStep(step) {
    let isValid = true;
    const stepEl = document.querySelector(`.form-step[data-step="${step}"]`);
    
    // Clear previous errors
    stepEl.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));
    stepEl.querySelectorAll('.field-error-message').forEach(el => el.remove());
    stepEl.querySelectorAll('.phone-input-group').forEach(el => {
      el.classList.remove('has-error', 'has-success');
    });
    
    if (step === 1) {
      // Validate first name
      const firstName = document.getElementById('firstName');
      if (!firstName.value.trim()) {
        showError(firstName, 'First name is required');
        isValid = false;
      }
      
      // Validate last name
      const lastName = document.getElementById('lastName');
      if (!lastName.value.trim()) {
        showError(lastName, 'Last name is required');
        isValid = false;
      }
      
      // Validate username
      const username = document.getElementById('username');
      if (!username.value.trim()) {
        showError(username, 'Username is required');
        isValid = false;
      } else if (!/^[a-zA-Z0-9_]+$/.test(username.value.trim())) {
        showError(username, 'Only letters, numbers, and underscores');
        isValid = false;
      }
      
      // Validate grade
      const grade = document.getElementById('grade');
      if (!grade.value) {
        showError(grade, 'Please select your year');
        isValid = false;
      }
      
      // Validate curriculum
      const curriculum = document.getElementById('curriculum');
      if (!curriculum.value) {
        showError(curriculum, 'Please select your curriculum');
        isValid = false;
      }
    }
    
    if (step === 2) {
      // Validate email
      const email = document.getElementById('studentEmail');
      if (!email.value.trim()) {
        showError(email, 'Email is required');
        isValid = false;
      } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) {
        showError(email, 'Please enter a valid email');
        isValid = false;
      }
      
      // Validate student phone (optional but if filled, must be valid)
      const studentNumber = document.getElementById('studentNumber');
      const studentCountryCode = document.getElementById('studentCountryCode');
      const studentPhoneGroup = document.getElementById('studentPhoneGroup');
      
      if (studentNumber.value.trim()) {
        const phoneValidation = validatePhoneNumber(studentNumber.value.trim(), studentCountryCode.value);
        if (!phoneValidation.valid) {
          studentPhoneGroup.classList.add('has-error');
          showPhoneError('studentPhoneHint', phoneValidation.message);
          isValid = false;
        } else {
          studentPhoneGroup.classList.add('has-success');
        }
      }
      
      // Validate parent phone (optional but if filled, must be valid)
      const parentNumber = document.getElementById('parentNumber');
      const parentCountryCode = document.getElementById('parentCountryCode');
      const parentPhoneGroup = document.getElementById('parentPhoneGroup');
      
      if (parentNumber.value.trim()) {
        const phoneValidation = validatePhoneNumber(parentNumber.value.trim(), parentCountryCode.value);
        if (!phoneValidation.valid) {
          parentPhoneGroup.classList.add('has-error');
          showPhoneError('parentPhoneHint', phoneValidation.message);
          isValid = false;
        } else {
          parentPhoneGroup.classList.add('has-success');
        }
      }
    }
    
    if (step === 3) {
      // Validate password
      const password = document.getElementById('password');
      if (!password.value || password.value.length < 4) {
        showError(password, 'Password must be at least 4 characters');
        isValid = false;
      }
      
      // Validate confirm password
      const password2 = document.getElementById('password2');
      if (password.value !== password2.value) {
        showError(password2, 'Passwords do not match');
        isValid = false;
      }
      
      // Validate terms
      const termsCheck = document.getElementById('termsCheck');
      if (!termsCheck.checked) {
        termsCheck.parentElement.classList.add('field-error');
        isValid = false;
      }
    }
    
    return isValid;
  }
  
  // Show error message
  function showError(element, message) {
    element.classList.add('field-error');
    const errorDiv = document.createElement('div');
    errorDiv.className = 'field-error-message';
    errorDiv.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
    element.parentElement.appendChild(errorDiv);
  }
  
  // Show phone error
  function showPhoneError(hintId, message) {
    const hint = document.getElementById(hintId);
    hint.innerHTML = `<span style="color: #ef4444;"><i class="fas fa-exclamation-circle"></i> ${message}</span>`;
  }
  
  // Next step
  nextStepBtn.addEventListener('click', function() {
    if (validateStep(currentStep)) {
      currentStep++;
      updateSteps();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  });
  
  // Previous step
  prevStepBtn.addEventListener('click', function() {
    currentStep--;
    updateSteps();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
  
  // Form submission
  form.addEventListener('submit', function(e) {
    if (!validateStep(currentStep)) {
      e.preventDefault();
      return;
    }
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>Creating Account...</span> <i class="fas fa-spinner fa-spin"></i>';
  });
  
  // Toggle "Other" input
  const howDidYouKnow = document.getElementById('howDidYouKnow');
  howDidYouKnow.addEventListener('change', function() {
    const otherWrapper = document.getElementById('otherInputWrapper');
    if (this.value === 'Other') {
      otherWrapper.classList.add('visible');
    } else {
      otherWrapper.classList.remove('visible');
      document.getElementById('howDidYouKnowOther').value = '';
    }
  });
  
  // Check initial state
  if (howDidYouKnow.value === 'Other') {
    document.getElementById('otherInputWrapper').classList.add('visible');
  }
  
  // Initialize
  updateSteps();
});

// Toggle password visibility
function togglePassword(fieldId) {
  const field = document.getElementById(fieldId);
  const icon = field.parentElement.querySelector('.btn-password-toggle i');
  
  if (field.type === 'password') {
    field.type = 'text';
    icon.classList.remove('fa-eye');
    icon.classList.add('fa-eye-slash');
  } else {
    field.type = 'password';
    icon.classList.remove('fa-eye-slash');
    icon.classList.add('fa-eye');
  }
}
</script>

<%- include('../partials/footer') %>

